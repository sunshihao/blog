<!DOCTYPE html><html class=" m-0 h-full p-0 font-sans antialiased" lang="zh-CN"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/docs/_next/static/css/8cd2eb158671e11e.css" data-precedence="next"/><link rel="stylesheet" href="/docs/_next/static/css/cc5160e2067b0cef.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/docs/_next/static/chunks/webpack-583a4211ac78a2fe.js"/><script src="/docs/_next/static/chunks/f064a1f5-a0f684639c5e404a.js" async=""></script><script src="/docs/_next/static/chunks/904-8193403601d33346.js" async=""></script><script src="/docs/_next/static/chunks/main-app-7d4b4602e3445646.js" async=""></script><script src="/docs/_next/static/chunks/779-ad4ead70309b9a20.js" async=""></script><script src="/docs/_next/static/chunks/739-1be71c4fce382004.js" async=""></script><script src="/docs/_next/static/chunks/138-7f27ef5cd2caf4b4.js" async=""></script><script src="/docs/_next/static/chunks/857-68a2fd358cb70760.js" async=""></script><script src="/docs/_next/static/chunks/594-71c3251836d38f7c.js" async=""></script><script src="/docs/_next/static/chunks/app/(app)/posts/%5Bid%5D/page-6bb6cd9ad97d098b.js" async=""></script><script src="/docs/_next/static/chunks/531-f976d425ce9a81a1.js" async=""></script><script src="/docs/_next/static/chunks/103-1875d9378f90876a.js" async=""></script><script src="/docs/_next/static/chunks/868-9c31f7c0009643d5.js" async=""></script><script src="/docs/_next/static/chunks/app/(app)/layout-66a850f3e6447c7d.js" async=""></script><script src="/docs/_next/static/chunks/245-4d9cc7d916e46c69.js" async=""></script><script src="/docs/_next/static/chunks/app/layout-d7953313cc6bdbf6.js" async=""></script><script src="/docs/_next/static/chunks/app/not-found-8b889a2f44e80cbe.js" async=""></script><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=123" as="script"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000212"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fafafa"/><title>DOM元素导出图片与PDF：多种方案对比与实现 | William Sun</title><meta name="description" content="DOM元素导出图片与PDF：多种方案对比与实现 - William Sun"/><link rel="manifest" href="/site.webmanifest" crossorigin="use-credentials"/><meta name="keywords" content="pdf 生成,png 导出"/><meta name="baidu-site-verification" content="codeva-7AmpPWgzQY"/><meta name="google-site-verification" content="TTbfOvWmLj0icfk0BQNUZB3crwReji82Q_vRdnZFFAc"/><link rel="canonical" href="https://dhc.ink/posts/post-20"/><link rel="alternate" type="application/rss+xml" title="RSS 订阅" href="https://luckysnail.cn/rss"/><meta property="og:title" content="DOM元素导出图片与PDF：多种方案对比与实现"/><meta property="og:description" content="DOM元素导出图片与PDF：多种方案对比与实现 - William Sun"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="@haozhan05554957"/><meta name="twitter:title" content="William Sunblog | 前端 | 开发者"/><meta name="twitter:description" content="我是William Sun，一名充满热情的前端开发工程师。我热衷于探索和体验最新技术，特别是人工智能（AI），并在日常工作中去使用它们，来提升我的工作效率。我的目标是积极参与开源社区，为开源项目贡献自己的力量。正如我的名字，我相信越努力，越幸运"/><meta name="twitter:image" content="https://luckysnail.cn/og.png"/><link rel="icon" href="/docs/favicon.ico" type="image/x-icon" sizes="32x32"/><link rel="icon" href="/docs/icon.jpg?021a5ddd40907a91" type="image/jpeg" sizes="256x256"/><link rel="apple-touch-icon" href="/docs/apple-icon.jpg?58f0c05bf91c4519" type="image/jpeg" sizes="1022x1023"/><script src="/docs/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="z-[-1] absolute bottom-0 left-0 right-0 top-0 bg-[linear-gradient(to_right,#4f4f4f2e_1px,transparent_1px),linear-gradient(to_bottom,#4f4f4f2e_1px,transparent_1px)] bg-[size:14px_24px] [mask-image:radial-gradient(ellipse_80%_50%_at_50%_0%,#000_70%,transparent_110%)]"></div><div class="fixed inset-0 flex justify-center sm:px-8"><div class="flex w-full max-w-7xl lg:px-8"><div class="opacity-95 w-full bg-zinc-50/90 ring-1 ring-zinc-100 dark:bg-zinc-900/80 dark:ring-zinc-400/20"></div></div></div><div class="relative text-zinc-800 dark:text-zinc-200"><header class="pointer-events-none relative z-50 mb-[var(--header-mb,0px)] flex flex-col h-[var(--header-height,64px)]"><div class="top-0 z-10 h-16 pt-6" style="position:var(--header-position)"><div class="sm:px-8 top-[var(--header-top,theme(spacing.6))] w-full" style="position:var(--header-inner-position)"><div class="mx-auto max-w-7xl lg:px-8"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="relative flex gap-4"><div class="flex flex-1" style="opacity:0;transform:translateY(15px)"><div><div class="h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:ring-white/10"><a aria-label="主页" class="pointer-events-auto" href="/docs"><img alt="" loading="lazy" width="256" height="256" decoding="async" data-nimg="1" class="rounded-full bg-zinc-100 object-cover dark:bg-zinc-800 h-9 w-9" style="color:transparent" src="/docs/_next/static/media/logo.d3f4655a.webp"/></a></div></div></div><div class="flex flex-1 justify-end md:justify-center"><button class="group flex items-center rounded-full bg-gradient-to-b from-zinc-50/20 to-white/80 px-4 py-2 text-sm font-medium text-zinc-800 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur-md focus:outline-none focus-visible:ring-2 dark:from-zinc-900/30 dark:to-zinc-800/80 dark:text-zinc-200 dark:ring-white/10 dark:hover:ring-white/20 dark:focus-visible:ring-yellow-500/80 pointer-events-auto relative z-50 md:hidden" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R3abnqra:" data-state="closed">前往<svg viewBox="0 0 8 6" aria-hidden="true" class="ml-3 h-auto w-2 stroke-zinc-500 group-hover:stroke-zinc-700 dark:group-hover:stroke-zinc-400"><path d="M1.75 1.75 4 4.25l2.25-2.5" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><nav class="group rounded-full bg-gradient-to-b from-zinc-50/70 to-white/90 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur-md dark:from-zinc-900/70 dark:to-zinc-800/90 dark:ring-zinc-100/10 [--spotlight-color:rgb(236_252_203_/_0.6)] dark:[--spotlight-color:rgb(217_249_157_/_0.07)] pointer-events-auto relative z-50 hidden md:block"><div class="pointer-events-none absolute -inset-px rounded-full opacity-0 transition-opacity duration-500 group-hover:opacity-100" aria-hidden="true" style="background:radial-gradient(0px circle at 0px 0px, var(--spotlight-color) 0%, transparent 65%)"></div><ul class="flex bg-transparent px-3 text-sm font-medium text-zinc-800 dark:text-zinc-200 "><li class="relative block whitespace-nowrap px-3 py-2 transition hover:text-violet-500 dark:hover:text-violet-400"><a target="_self" href="/docs">首页</a></li><li class="relative block whitespace-nowrap px-3 py-2 transition hover:text-violet-500 dark:hover:text-violet-400"><a target="_self" href="/docs/posts">博客</a></li><li class="relative block whitespace-nowrap px-3 py-2 transition hover:text-violet-500 dark:hover:text-violet-400"><a target="_self" href="/docs/about">关于我</a></li></ul></nav></div><div class="flex justify-end gap-3 md:flex-1" style="opacity:0;transform:translateY(-20px) scale(0.95)"><div class="pointer-events-auto"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></div></div></div></div></div></div></div></div></header><main><!--$--><div class="sm:px-8 mt-10 lg:mt-16"><div class="mx-auto max-w-7xl lg:px-8"><div class="relative px-4 sm:px-8 lg:px-12 !px-0"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="w-full md:flex md:justify-between xl:relative gap-1"><aside class="hidden w-[160px] shrink-0 lg:block"><div class="sticky top-2 pt-16"><div class="toc-container"><h2 class="text-lg font-semibold mb-4">目录</h2><ul class="js-toc group pointer-events-auto flex flex-col space-y-2 text-zinc-500" style="opacity:0"></ul></div></div></aside><div class="max-w-4xl md:flex-1 md:shrink-0 "><a class="group mb-8 flex h-10 w-10 items-center justify-center bg-white dark:border dark:border-zinc-700/50 dark:bg-zinc-800 dark:ring-0 dark:hover:border-zinc-700 lg:absolute lg:-left-5 lg:-mt-2 lg:mb-0 xl:-top-1.5 xl:left-0 xl:mt-0 group rounded-full bg-gradient-to-b from-zinc-50/50 to-white/90 px-3 py-2 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur transition dark:from-zinc-900/50 dark:to-zinc-800/90 dark:ring-white/10 dark:hover:ring-white/20" aria-label="返回博客页面" href="/docs/posts"><svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 stroke-zinc-500 transition group-hover:stroke-zinc-700 dark:stroke-zinc-500 dark:group-hover:stroke-zinc-400"><path d="M8.03089 4C6.57669 5.05865 5.2706 6.29537 4.14485 7.67887C4.04828 7.79755 4 7.94044 4 8.08333M8.03089 12.1667C6.57669 11.108 5.2706 9.8713 4.14485 8.4878C4.04828 8.36912 4 8.22623 4 8.08333M4 8.08333H14.963C17.7448 8.08333 20 10.3033 20 13.0417C20 15.7801 17.7448 18 14.963 18H12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></a><article data-postid="data/blog/post-20.mdx" class="rich-text-viewer prose px-4"><div class="mb-8 text-center"><h1 class="text-3xl font-bold">DOM元素导出图片与PDF：多种方案对比与实现</h1><div class="flex justify-center rounded-md  h-5 items-center space-x-4 text-sm"><time dateTime="2024-09-27T08:27:42.000Z" class="mb-1 text-xs text-gray-600">2024-09-27</time><div data-orientation="vertical" role="none" class="shrink-0 bg-border h-full w-[1px]"></div><span class="mb-1 text-xs text-gray-600 flex items-center"><svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="mr-2"><path d="M10.1912 12.5508C10.3071 12.1942 10.3071 11.8058 10.1912 11.4492C9.22165 8.46673 4.40272 8.00546 4.01443 4.48436C3.93458 3.76031 4.18955 3.04013 4.69671 2.55723C5.28193 2 6.62415 2 9.30861 2H14.6914C17.3759 2 18.7181 2 19.3033 2.55723C19.8104 3.04013 20.0654 3.76031 19.9856 4.48436C19.5973 8.00546 14.7784 8.46673 13.8088 11.4492C13.6929 11.8058 13.6929 12.1942 13.8088 12.5508C14.7784 15.5333 19.5973 15.9945 19.9856 19.5156C20.0654 20.2397 19.8104 20.9599 19.3033 21.4428C18.7181 22 17.3758 22 14.6914 22L9.3086 22C6.62415 22 5.28192 22 4.69671 21.4428C4.18955 20.9599 3.93458 20.2397 4.01442 19.5156C4.40272 15.9945 9.22164 15.5333 10.1912 12.5508Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg> <!-- -->28<!-- --> 分钟</span></div><div class="flex w-full justify-center gap-2 mt-2"><span class="inline-flex items-center px-2 h-5 rounded-md text-xs  bg-gray-300 text-gray-800">pdf 生成</span><span class="inline-flex items-center px-2 h-5 rounded-md text-xs  bg-gray-300 text-gray-800">png 导出</span></div></div><div class="js-toc-content"><blockquote>
<p>文章详细介绍了将 HTML DOM 元素转换为图片或 PDF 的多种方法，包括使用 html2canvas、dom-to-image、Puppeteer 和 canvas原生绘制等技术。文章分析了每种方法的实现过程、使用场景、优缺点，并提供了代码示例，帮助开发者根据具体需求选择合适的解决方案。</p>
</blockquote>
<h1 id="背景"><a class="anchor" href="#背景">背景</a></h1>
<p>在日常前端开发中，经常会有把页面的 DOM 元素作为 PNG 或者 PDF 下载到本地的需求。例如海报功能，简历导出功能等等。在我们自家的产品「代码小抄」中，就使用了 html2canvas 来实现代码片段导出为图片：</p>
<p></p>
<p>是不是还行，大家如果想要分享代码片段，可以试试，非常好用。那有哪些方法可以实现下载 DOM 元素到本地呢？目前收集到的有：</p>
<ul>
<li>通过 html2canvas 、dom-to-image 等第三方库实现</li>
<li>通过 Puppeteer 启动一个 node 服务实现</li>
<li>canvas 原生绘制</li>
</ul>
<p>这些方式是真实项目会使用的方式，针对不同场景可以使用不同的方法，下面看一下每种方法如何实现、使用场景和优缺点，</p>
<h1 id="方案-1---html2canvas"><a class="anchor" href="#方案-1---html2canvas">方案 1 - html2canvas</a></h1>
<p>html2canvas 专门用于解析 DOM 结构及其关联的 CSS 样式，进而将网页内容渲染为 Canvas 元素的 JavaScript 库，下面是下载元素为 PNG 的示例代码：</p>
<pre class="language-typescript"><code class="language-typescript code-highlight"><span class="code-line"><span class="token comment">/**
</span></span><span class="code-line"><span class="token comment"> * 下载 dom 元素为图片
</span></span><span class="code-line"><span class="token comment"> * @param elementId DOM 元素id
</span></span><span class="code-line"><span class="token comment"> * @param fileName 下载图片的文件名
</span></span><span class="code-line"><span class="token comment"> * @returns
</span></span><span class="code-line"><span class="token comment"> */</span>
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">downloadDOMElementAsImage</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>elementId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> fileName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>elementId<span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLElement<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>element<span class="token punctuation">)</span> <span class="token keyword">return</span> message<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#x27;无法找到 DOM 元素&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">try</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// 将 DOM 元素转换为 canvas</span>
</span><span class="code-line">    <span class="token keyword">const</span> canvas <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">html2canvas</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line">      useCORS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</span><span class="code-line">      allowTaint<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token comment">// 提高清晰度</span>
</span><span class="code-line">      scale<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
</span><span class="code-line">      backgroundColor<span class="token operator">:</span> <span class="token string">&#x27;transparent&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment">// 将 canvas 转换为数据 URL</span>
</span><span class="code-line">    <span class="token keyword">const</span> dataUrl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">&#x27;image/png&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment">// 创建一个临时的 &lt;a&gt; 元素，设置其 href 为数据 URL 并设置 download 属性</span>
</span><span class="code-line">    <span class="token keyword">const</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#x27;a&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    link<span class="token punctuation">.</span>style<span class="token punctuation">.</span>visibility <span class="token operator">=</span> <span class="token string">&#x27;hidden&#x27;</span><span class="token punctuation">;</span>
</span><span class="code-line">    link<span class="token punctuation">.</span>href <span class="token operator">=</span> dataUrl<span class="token punctuation">;</span>
</span><span class="code-line">    link<span class="token punctuation">.</span>download <span class="token operator">=</span> fileName<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// 将 &lt;a&gt; 元素添加到 DOM，触发点击事件，然后从 DOM 中移除</span>
</span><span class="code-line">    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    link<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#x27;无法将 DOM 元素转换为图片并下载&#x27;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">  element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token string">&#x27;scale(1)&#x27;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code></pre>
<p>通过 html2canvas ，我们封装了一个下载页面 DOM 为图片的方法，然后就可以很方便的调用方法进行页面元素的下载</p>
<h2 id="使用场景"><a class="anchor" href="#使用场景">使用场景</a></h2>
<p>适用于需要将复杂的 DOM 结构（包括样式、背景图像、字体等）渲染为图片的场景。它可以捕获大部分 CSS 样式和 HTML 内容</p>
<h2 id="优缺点"><a class="anchor" href="#优缺点">优缺点</a></h2>
<p>优点：</p>
<ul>
<li>使用非常简单，支持大多数 css</li>
<li>内置跨域解决方案</li>
<li>可以通过 ignoreElements 过滤指定 DOM，这在处理<strong>复杂 DOM 结构</strong>的时候非常有用</li>
</ul>
<p>缺点：</p>
<ul>
<li>下载的图可能不清晰</li>
<li>库比较大</li>
<li>计算耗时，性能不好</li>
<li>部分特殊的样式可能不支持，存在兼容性问题</li>
</ul>
<h1 id="方案-2---dom-to-image"><a class="anchor" href="#方案-2---dom-to-image">方案 2 - dom-to-image</a></h1>
<p>dom-to-image 是一个用 JavaScript 编写的库，可以将任意 DOM 节点转换为矢量（SVG）或光栅（PNG 或 JPEG）图像。它和 html2canvas 一样也是基于 canvas 封装的库。看一下生成 PNG 的示例代码：</p>
<pre class="language-typescript"><code class="language-typescript code-highlight"><span class="code-line"><span class="token comment">/**
</span></span><span class="code-line"><span class="token comment"> * 下载 DOM 元素为高质量图片
</span></span><span class="code-line"><span class="token comment"> * @param elementId DOM 元素id
</span></span><span class="code-line"><span class="token comment"> * @param fileName 下载图片的文件名
</span></span><span class="code-line"><span class="token comment"> * @param sc 缩放比
</span></span><span class="code-line"><span class="token comment"> * @returns
</span></span><span class="code-line"><span class="token comment"> */</span>
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">downloadDOMElementAsImage</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>elementId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> fileName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> sc <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>elementId<span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLElement<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>element <span class="token operator">||</span> <span class="token operator">!</span>window <span class="token operator">||</span> <span class="token operator">!</span>document<span class="token punctuation">)</span> <span class="token keyword">return</span> message<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">&quot;无法找到 DOM 元素&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> messageKey <span class="token operator">=</span> <span class="token string">&quot;loading&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">  message<span class="token punctuation">.</span><span class="token function">loading</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    content<span class="token operator">:</span> <span class="token string">&quot;正在下载...&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    duration<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
</span><span class="code-line">    key<span class="token operator">:</span> messageKey<span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">try</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">const</span> clone <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLElement<span class="token punctuation">;</span>
</span><span class="code-line">    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>clone<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment">// 临时增加元素尺寸以提高分辨率</span>
</span><span class="code-line">    <span class="token keyword">const</span> originalWidth <span class="token operator">=</span> element<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">const</span> originalHeight <span class="token operator">=</span> element<span class="token punctuation">.</span>offsetHeight<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">const</span> scale <span class="token operator">=</span> sc<span class="token punctuation">;</span> <span class="token comment">// 增加缩放因子以提高分辨率</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// 设置相对定位，zIndex 为 -1</span>
</span><span class="code-line">    clone<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">&quot;relative&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment">// clone.style.zIndex = &quot;-1&quot;;</span>
</span><span class="code-line">    clone<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">scale(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scale<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    clone<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transformOrigin <span class="token operator">=</span> <span class="token string">&quot;top left&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">const</span> dataUrl <span class="token operator">=</span> <span class="token keyword">await</span> domtoimage<span class="token punctuation">.</span><span class="token function">toPng</span><span class="token punctuation">(</span>clone<span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line">      width<span class="token operator">:</span> originalWidth <span class="token operator">*</span> scale<span class="token punctuation">,</span>
</span><span class="code-line">      height<span class="token operator">:</span> originalHeight <span class="token operator">*</span> scale<span class="token punctuation">,</span>
</span><span class="code-line">      style<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">        transform<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">scale(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scale<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
</span><span class="code-line">        transformOrigin<span class="token operator">:</span> <span class="token string">&quot;top left&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        width<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>originalWidth<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
</span><span class="code-line">        height<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>originalHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">      cacheBust<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</span><span class="code-line">      quality<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
</span><span class="code-line">      bgcolor<span class="token operator">:</span> <span class="token string">&quot;transparent&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// 创建下载链接</span>
</span><span class="code-line">    <span class="token keyword">const</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    link<span class="token punctuation">.</span>href <span class="token operator">=</span> dataUrl<span class="token punctuation">;</span>
</span><span class="code-line">    link<span class="token punctuation">.</span>download <span class="token operator">=</span> fileName<span class="token punctuation">;</span>
</span><span class="code-line">    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    link<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    message<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>messageKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>clone<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    message<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>messageKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;下载失败&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;下载失败: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code></pre>
<p>可以看到使用也非常简单，我们可以通过 sc 参数来控制下载图片的清晰度和大小。</p>
<h2 id="使用场景-1"><a class="anchor" href="#使用场景-1">使用场景</a></h2>
<p>如果对项目大小有要求，希望文本排版支持度高，需要稳定的文字、图片渲染能力或者处理结构化数据的能力，可以使用 dom-to-image</p>
<h2 id="优缺点-1"><a class="anchor" href="#优缺点-1">优缺点</a></h2>
<p>优点：</p>
<ul>
<li>库比较轻量</li>
<li>适用于需要多格式导出的场景</li>
</ul>
<p>缺点：</p>
<ul>
<li>需要手动处理跨域</li>
</ul>
<h1 id="方案-31---puppeteer"><a class="anchor" href="#方案-31---puppeteer">方案 3.1 - Puppeteer</a></h1>
<p>上面两种方法虽然可以在 web 端生成图片，但是如果需要：</p>
<ul>
<li>兼容多端，</li>
<li>同时支持生成 PNG 和 PDF，并且要求非常清晰，</li>
<li>兼容图片跨域</li>
<li>兼容所有 css</li>
<li>对项目体积有要求</li>
</ul>
<p>那我们就可以使用 Puppeteer 来实现，它可以解决上面所有的问题。Puppeteer 是一个强大的 Node.js 库，用于控制 Chrome 或 Chromium 浏览器来帮我们生成想要的 PNG 或者 PDF，下面我们就使用 express + Puppeteer 来快速实现一个图片下载服务：</p>
<pre class="language-javascript"><code class="language-javascript code-highlight"><span class="code-line"><span class="token comment">// node 服务 app.js 示例代码</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports">cors</span> <span class="token keyword module">from</span> <span class="token string">&quot;cors&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports">express</span> <span class="token keyword module">from</span> <span class="token string">&quot;express&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports">puppeteer</span> <span class="token keyword module">from</span> <span class="token string">&quot;puppeteer&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&quot;面试刷题，我只用面试鸭~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">&quot;/download&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> url<span class="token punctuation">,</span> quality<span class="token punctuation">,</span> format<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> domId<span class="token punctuation">,</span> type <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>url <span class="token operator">||</span> <span class="token operator">!</span>filename <span class="token operator">||</span> <span class="token operator">!</span>domId <span class="token operator">||</span> <span class="token operator">!</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&quot;Missing required parameters&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// 启动浏览器</span>
</span><span class="code-line">    <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword control-flow">await</span> puppeteer<span class="token punctuation">.</span><span class="token method function property-access">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment">// 新建一个页面</span>
</span><span class="code-line">    <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword control-flow">await</span> browser<span class="token punctuation">.</span><span class="token method function property-access">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment">// 设置默认一分钟超时</span>
</span><span class="code-line">    <span class="token keyword control-flow">await</span> page<span class="token punctuation">.</span><span class="token method function property-access">setDefaultNavigationTimeout</span><span class="token punctuation">(</span><span class="token number">60000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment">// 打开页面</span>
</span><span class="code-line">    <span class="token keyword control-flow">await</span> page<span class="token punctuation">.</span><span class="token method function property-access">goto</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">waitUntil</span><span class="token operator">:</span> <span class="token string">&quot;networkidle0&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&quot;png&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token comment">// 等待元素加载</span>
</span><span class="code-line">      <span class="token keyword control-flow">await</span> page<span class="token punctuation">.</span><span class="token method function property-access">waitForSelector</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>domId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token comment">// 等待元素加载</span>
</span><span class="code-line">      <span class="token keyword control-flow">await</span> page<span class="token punctuation">.</span><span class="token method function property-access">waitForSelector</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>domId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token comment">// 截取指定元素的截图</span>
</span><span class="code-line">      <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token keyword control-flow">await</span> page<span class="token punctuation">.</span><span class="token method function property-access">$</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>domId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token string">&quot;element&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token keyword">const</span> imageBuffer <span class="token operator">=</span> <span class="token keyword control-flow">await</span> element<span class="token punctuation">.</span><span class="token method function property-access">screenshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;jpeg&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token literal-property property">quality</span><span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>quality<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 仅适用于 jpeg</span>
</span><span class="code-line">        <span class="token comment">// omitBackground: true,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token keyword control-flow">await</span> browser<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      res<span class="token punctuation">.</span><span class="token method function property-access">contentType</span><span class="token punctuation">(</span><span class="token string">&quot;image/jpeg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      res<span class="token punctuation">.</span><span class="token method function property-access">attachment</span><span class="token punctuation">(</span>filename <span class="token operator">+</span> <span class="token string">&quot;.jpeg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token comment">// 返回二进制数据给前端</span>
</span><span class="code-line">      res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token maybe-class-name">Buffer</span><span class="token punctuation">.</span><span class="token keyword module">from</span><span class="token punctuation">(</span>imageBuffer<span class="token punctuation">,</span> <span class="token string">&quot;binary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&quot;pdf&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">const</span> pdf <span class="token operator">=</span> <span class="token keyword control-flow">await</span> page<span class="token punctuation">.</span><span class="token method function property-access">pdf</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token literal-property property">format</span><span class="token operator">:</span> format <span class="token operator">||</span> <span class="token string">&quot;A4&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token literal-property property">printBackground</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token literal-property property">pageRanges</span><span class="token operator">:</span> <span class="token string">&quot;1-&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">pages</span> <span class="token operator">||</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      res<span class="token punctuation">.</span><span class="token method function property-access">contentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/pdf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      res<span class="token punctuation">.</span><span class="token method function property-access">attachment</span><span class="token punctuation">(</span><span class="token string">&quot;resume.pdf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token comment">// 返回二进制数据给前端</span>
</span><span class="code-line">      res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token maybe-class-name">Buffer</span><span class="token punctuation">.</span><span class="token keyword module">from</span><span class="token punctuation">(</span>pdf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">      res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword control-flow">await</span> browser<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&quot;Internal Server Error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">3001</span><span class="token punctuation">;</span>
</span><span class="code-line">app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server is running on http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>通过 Puppeteer 我们可以很方便的进行屏幕截取，因为它就是通过游览器内核来实现，所以它能完全还原展示效果</p>
<h2 id="使用场景-2"><a class="anchor" href="#使用场景-2">使用场景</a></h2>
<p>如果需要下载图片和 PDF，对图片清晰度还有要求，页面元素还比较复杂，生成图片和 PDF 需要多端支持等等，可以使用 Puppeteer 来实现</p>
<h2 id="优缺点-2"><a class="anchor" href="#优缺点-2">优缺点</a></h2>
<p>优点：</p>
<ul>
<li>高度还原视图：Puppeteer 使用的是无头 Chrome 浏览器，所以它生成的 PDF 和截图与用户在浏览器中看到的内容几乎完全一致</li>
<li>丰富的 API： Puppeteer 提供了超多 API，基本可以解决所有遇到的问题，相关文档地址：<a href="https://github.com/puppeteer/puppeteer/blob/v1.5.0/docs/api.md">https://github.com/puppeteer/puppeteer/blob/v1.5.0/docs/api.md</a>，非常多的 API</li>
<li>支持最新的 css：由于 Puppeteer 使用的是 Chrome 浏览器，它支持所有现代 Web 特性，因此它在处理复杂网页时非常有优势</li>
<li>跨域资源支持： Puppeteer 通常以无头模式运行，这种模式下浏览器跨域访问的限制会放宽</li>
</ul>
<p>缺点：</p>
<ul>
<li>需要部署服务：Puppeteer 需要在服务器端运行，需要一个后端环境来支持它。</li>
<li>资源消耗大： 由于 Puppeteer 启动的是一个完整的 Chrome 浏览器实例，因此它的资源消耗相对较大，可能会影响服务器的性能</li>
<li>额外的学习成本：如果团队都对 Puppeteer 不了解，可能需要额外的学习和维护成本</li>
</ul>
<p>但是如果使用 Puppeteer 去生产环境使用，可能还会有同时处理大量请求导致服务资源被消耗光，甚至导致下载服务奔溃的情况，这时候我们就可以使用 puppeteer-cluster 来实现请求队列， 使用队列系统来管理请求，确保同时只处理一定数量的请求，其他请求则排队等待</p>
<h1 id="方案-32---puppeteer-cluster"><a class="anchor" href="#方案-32---puppeteer-cluster">方案 3.2 - puppeteer-cluster</a></h1>
<p>代码示例：</p>
<pre class="language-javascript"><code class="language-javascript code-highlight"><span class="code-line"><span class="token comment">// 源码：https://github.com/chaseFunny/pdf-png-downloader</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports">cors</span> <span class="token keyword module">from</span> <span class="token string">&quot;cors&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports">express</span> <span class="token keyword module">from</span> <span class="token string">&quot;express&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Cluster</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">&quot;puppeteer-cluster&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">let</span> cluster<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// 初始化 cluster</span>
</span><span class="code-line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">initCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  cluster <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Cluster</span><span class="token punctuation">.</span><span class="token method function property-access">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token literal-property property">concurrency</span><span class="token operator">:</span> <span class="token maybe-class-name">Cluster</span><span class="token punctuation">.</span><span class="token constant">CONCURRENCY_CONTEXT</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token literal-property property">maxConcurrency</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 最大并发数,可以根据服务器资源调整</span>
</span><span class="code-line">    <span class="token literal-property property">puppeteerOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;--no-sandbox&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;--disable-setuid-sandbox&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token comment">// 定义任务处理函数</span>
</span><span class="code-line">  <span class="token keyword control-flow">await</span> cluster<span class="token punctuation">.</span><span class="token method function property-access">task</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> page<span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> url<span class="token punctuation">,</span> domId<span class="token punctuation">,</span> type<span class="token punctuation">,</span> quality<span class="token punctuation">,</span> format<span class="token punctuation">,</span> pages <span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">await</span> page<span class="token punctuation">.</span><span class="token method function property-access">goto</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">waitUntil</span><span class="token operator">:</span> <span class="token string">&quot;networkidle0&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&quot;png&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword control-flow">await</span> page<span class="token punctuation">.</span><span class="token method function property-access">waitForSelector</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>domId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token keyword control-flow">await</span> page<span class="token punctuation">.</span><span class="token method function property-access">$</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>domId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> element<span class="token punctuation">.</span><span class="token method function property-access">screenshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;jpeg&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token literal-property property">quality</span><span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>quality<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&quot;pdf&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> page<span class="token punctuation">.</span><span class="token method function property-access">pdf</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token literal-property property">format</span><span class="token operator">:</span> format <span class="token operator">||</span> <span class="token string">&quot;A4&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token literal-property property">printBackground</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token literal-property property">pageRanges</span><span class="token operator">:</span> <span class="token string">&quot;1-&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>pages <span class="token operator">||</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;Cluster initialized&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">initCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&quot;面试刷题，我只用面试鸭~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">&quot;/download&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> url<span class="token punctuation">,</span> quality<span class="token punctuation">,</span> format<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> domId<span class="token punctuation">,</span> type<span class="token punctuation">,</span> pages <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>url <span class="token operator">||</span> <span class="token operator">!</span>filename <span class="token operator">||</span> <span class="token operator">!</span>domId <span class="token operator">||</span> <span class="token operator">!</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&quot;Missing required parameters&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> cluster<span class="token punctuation">.</span><span class="token method function property-access">execute</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token punctuation">,</span> domId<span class="token punctuation">,</span> type<span class="token punctuation">,</span> quality<span class="token punctuation">,</span> format<span class="token punctuation">,</span> pages <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&quot;png&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      res<span class="token punctuation">.</span><span class="token method function property-access">contentType</span><span class="token punctuation">(</span><span class="token string">&quot;image/png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      res<span class="token punctuation">.</span><span class="token method function property-access">attachment</span><span class="token punctuation">(</span>filename <span class="token operator">+</span> <span class="token string">&quot;.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token maybe-class-name">Buffer</span><span class="token punctuation">.</span><span class="token keyword module">from</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&quot;pdf&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      res<span class="token punctuation">.</span><span class="token method function property-access">contentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/pdf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      res<span class="token punctuation">.</span><span class="token method function property-access">attachment</span><span class="token punctuation">(</span>filename <span class="token operator">+</span> <span class="token string">&quot;.pdf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token maybe-class-name">Buffer</span><span class="token punctuation">.</span><span class="token keyword module">from</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">      res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&quot;Internal Server Error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">3001</span><span class="token punctuation">;</span>
</span><span class="code-line">app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server is running on http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// 优雅关闭</span>
</span><span class="code-line">process<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&quot;SIGINT&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;Closing cluster...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword control-flow">await</span> cluster<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  process<span class="token punctuation">.</span><span class="token method function property-access">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>我们使用 puppeteer-cluster 创建了一个浏览器实例池，有如下优点：</p>
<ul>
<li>可以更有效地处理并发请求，它会自动把接受的请求加入队列，保证所有请求都会进行处理。</li>
<li>将 PDF 和 PNG 生成的逻辑移到了 cluster.task 中，这样可以重用浏览器实例，提高效率</li>
<li>设置了最大并发数（maxConcurrency），可以根据服务器资源进行调整,避免资源耗尽</li>
</ul>
<p>**注意：**在生产环境，我们可能需要在 puppeteerOptions 的 executablePath 设置具体的 chrome 路径，保证服务能找到 chorme</p>
<h1 id="方案-4---canvas-原生绘制"><a class="anchor" href="#方案-4---canvas-原生绘制">方案 4 - canvas 原生绘制</a></h1>
<p>参考代码：</p>
<pre class="language-javascript"><code class="language-javascript code-highlight"><span class="code-line"><span class="token comment">//获取canvas元素</span>
</span><span class="code-line"><span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span> <span class="token method function property-access">getElementById</span><span class="token punctuation">(</span> <span class="token string">&#x27;poster&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">var</span> ctx <span class="token operator">=</span> canvas <span class="token function">getContext</span> <span class="token punctuation">(</span><span class="token string">&#x27;2d&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token comment">// 设置canvas宽高</span>
</span><span class="code-line">canvas<span class="token punctuation">.</span><span class="token property-access">width</span> <span class="token operator">=</span> <span class="token number">600</span>
</span><span class="code-line">canvas<span class="token punctuation">.</span><span class="token property-access">height</span> <span class="token operator">=</span> <span class="token number">800</span>
</span><span class="code-line"><span class="token comment">// 绘制背景</span>
</span><span class="code-line">ctx<span class="token punctuation">.</span><span class="token property-access">fillStyle</span> <span class="token operator">=</span> <span class="token string">&#x27;#ff6600&#x27;</span>
</span><span class="code-line">ctx<span class="token punctuation">.</span> <span class="token method function property-access">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span><span class="token property-access">width</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span><span class="token property-access">height</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token comment">// 绘制文字</span>
</span><span class="code-line">ctx<span class="token punctuation">.</span> <span class="token property-access">font</span> <span class="token operator">=</span> <span class="token string">&#x27;bold 48px Arial&#x27;</span>
</span><span class="code-line">ctx<span class="token punctuation">.</span> <span class="token property-access">fillStyle</span> <span class="token operator">=</span> &#x27;#ffffff•
</span><span class="code-line">ctx<span class="token punctuation">.</span><span class="token property-access">textAlign</span> <span class="token operator">=</span> <span class="token string">&#x27;center&#x27;</span>
</span><span class="code-line">ctx<span class="token punctuation">.</span> <span class="token method function property-access">fillText</span> <span class="token punctuation">(</span><span class="token string">&#x27;*HEd&#x27;</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span><span class="token property-access">width</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span>
</span><span class="code-line">ctx<span class="token operator">-</span>font <span class="token operator">=</span> <span class="token string">&#x27;24px Arial&#x27;</span>
</span><span class="code-line">ctx<span class="token punctuation">.</span><span class="token property-access">fillText（</span>&#x27;这里是副标题
</span><span class="code-line">canvas<span class="token punctuation">.</span> <span class="token property-access">width</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token comment">// 绘制图片</span>
</span><span class="code-line"><span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span>（）
</span><span class="code-line">img<span class="token punctuation">.</span> <span class="token method-variable function-variable method function property-access">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">｛
</span><span class="code-line">ctx<span class="token punctuation">.</span> <span class="token method function property-access">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span>
</span><span class="code-line">｝
</span><span class="code-line">img<span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span><span class="token string">&#x27;图片地址&#x27;</span>
</span></code></pre>
<p>canvas 虽然高性能，但是工作量大，一般生产环境不会使用</p>
<h1 id="总结"><a class="anchor" href="#总结">总结</a></h1>
<p>在实际开发中，面对不同场景我们会使用不同的方案，那我们公司的线上项目为例：在我们的「面试鸭」和「编程导航」的生成海报功能都是使用了 html2canvas 来生成海报，因为它要比 Puppeteer 快，能够让用户更快拿到海报图，在「老鱼简历」中，我们使用 Puppeteer 来导出简历，这样导出的简历和看到的更加一致，并且清晰度更加高。</p>
<p>上面的代码都在仓库：<a href="https://github.com/chaseFunny/pdf-png-downloader">https://github.com/chaseFunny/pdf-png-downloader</a>，还提供了简单的页面方便大家体验调试</p>
<p></p>
<hr/>
<p>此文自动发布于：<a href="https://github.com/coderPerseus/blog/issues/20" target="_blank">github issues</a></p></div></article><div class="flex px-4 justify-between mt-8"><a class="inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium text-violet-500 dark:text-violet-300 shadow-sm hover:bg-violet-200 dark:hover:bg-violet-500 focus:outline-none focus:ring-2 focus:ring-violet-600 focus:ring-offset-2" href="/docs/posts/post-21">LLM RAG （大语言模型检索增强生成...</a><a class="inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium text-violet-500 dark:text-violet-300 shadow-sm hover:bg-violet-200 dark:hover:bg-violet-500 focus:outline-none focus:ring-2 focus:ring-violet-600 focus:ring-offset-2" href="/docs/posts/post-19">Taro3 + react 项目如何使用...</a></div></div></div></div></div></div></div><!--/$--></main><!--$--><footer class="mt-32"><div class="sm:px-8"><div class="mx-auto max-w-7xl lg:px-8"><div class="border-t border-zinc-100 pb-16 pt-10 dark:border-zinc-700/40"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="flex flex-col items-center justify-between gap-6 sm:flex-row"><p class="text-sm text-zinc-500/80 dark:text-zinc-400/80">© <!-- -->2025<!-- --> <!-- -->William Sun<!-- --> 网站已开源：<a class="inline-flex place-items-baseline items-baseline gap-0.5 pr-0.5 text-[0.95em] leading-none font-semibold text-zinc-800 hover:underline dark:text-zinc-100" rel="noopener noreferrer" target="_blank" href="https://github.com/coderPerseus/blog"><span class="mr-px inline-flex translate-y-0.5 dark:invert"><img alt="" aria-hidden="true" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="inline h-4 w-4 rounded" style="color:transparent" src="/docs/_next/static/media/github.ee3e4451.png"/></span>William Sun<svg width="0.95em" height="0.95em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline-block translate-y-0.5" aria-hidden="true"><path d="M20 13.5001C20 14.8946 20 15.5919 19.8618 16.1673C19.4229 17.9956 17.9955 19.423 16.1672 19.8619C15.5918 20.0001 14.8945 20.0001 13.5 20.0001H12C9.19974 20.0001 7.79961 20.0001 6.73005 19.4551C5.78924 18.9758 5.02433 18.2109 4.54497 17.2701C4 16.2005 4 14.8004 4 12.0001V11.5001C4 9.17035 4 8.0055 4.3806 7.08664C4.88807 5.8615 5.86144 4.88813 7.08658 4.38066C7.86344 4.05888 8.81614 4.00915 10.5 4.00146M19.7597 9.45455C20.0221 7.8217 20.0697 6.16984 19.9019 4.54138C19.8898 4.42328 19.838 4.31854 19.7597 4.24027M19.7597 4.24027C19.6815 4.16201 19.5767 4.11023 19.4586 4.09806C17.8302 3.93025 16.1783 3.97792 14.5455 4.24027M19.7597 4.24027L10 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></a></p><nav class="flex gap-6 text-sm font-medium text-zinc-800 dark:text-zinc-200"><a class="transition hover:text-violet-500 dark:hover:text-violet-400" href="/docs">首页</a><a class="transition hover:text-violet-500 dark:hover:text-violet-400" href="/docs/posts">博客</a><a class="transition hover:text-violet-500 dark:hover:text-violet-400" href="/docs/about">关于我</a></nav></div></div></div><div class="relative px-4 sm:px-8 lg:px-12 mt-6"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="flex flex-col items-center justify-start gap-2 sm:flex-row">欢迎 👏🏻 你的访问</div></div></div><div class="flex justify-center p-6 flex-col sm:flex-row"><a target="_blank" class="text-blue-600 flex justify-center items-center" href="https://beian.miit.gov.cn/"><img alt="备案" loading="lazy" width="18" height="18" decoding="async" data-nimg="1" class="mr-1 " style="color:transparent" src="/docs/police.png"/>辽公网安备21021202000334号</a><a target="_blank" class="text-blue-600 pl-6 flex justify-center items-center" href="https://beian.miit.gov.cn/">辽ICP备2021012379号-1</a></div></div></div></div></footer><!--/$--></div><script src="/docs/_next/static/chunks/webpack-583a4211ac78a2fe.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/docs/_next/static/css/8cd2eb158671e11e.css\",\"style\"]\n2:HL[\"/docs/_next/static/css/cc5160e2067b0cef.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[1439,[],\"\"]\n5:I[7401,[\"779\",\"static/chunks/779-ad4ead70309b9a20.js\",\"739\",\"static/chunks/739-1be71c4fce382004.js\",\"138\",\"static/chunks/138-7f27ef5cd2caf4b4.js\",\"857\",\"static/chunks/857-68a2fd358cb70760.js\",\"594\",\"static/chunks/594-71c3251836d38f7c.js\",\"878\",\"static/chunks/app/(app)/posts/%5Bid%5D/page-6bb6cd9ad97d098b.js\"],\"default\"]\n6:I[2219,[\"779\",\"static/chunks/779-ad4ead70309b9a20.js\",\"739\",\"static/chunks/739-1be71c4fce382004.js\",\"138\",\"static/chunks/138-7f27ef5cd2caf4b4.js\",\"857\",\"static/chunks/857-68a2fd358cb70760.js\",\"594\",\"static/chunks/594-71c3251836d38f7c.js\",\"878\",\"static/chunks/app/(app)/posts/%5Bid%5D/page-6bb6cd9ad97d098b.js\"],\"\"]\n7:I[6814,[\"779\",\"static/chunks/779-ad4ead70309b9a20.js\",\"739\",\"static/chunks/739-1be71c4fce382004.js\",\"138\",\"static/chunks/138-7f27ef5cd2caf4b4.js\",\"857\",\"static/chunks/857-68a2fd358cb70760.js\",\"594\",\"static/chunks/594-71c3251836d38f7c.js\",\"878\",\"static/chunks/app/(app)/posts/%5Bid%5D/page-6bb6cd9ad97d098b.js\"],\"Separator\"]\n8:I[8501,[\"779\",\"static/chunks/779-ad4ead70309b9a20.js\",\"739\",\"static/chunks/739-1be71c4fce382004.js\",\"138\",\"static/chunks/138-7f27ef5cd2caf4b4.js\",\"857\",\"static/chunks/857-68a2fd358cb70760.js\",\"594\",\"static/chunks/594-71c3251836d38f7c.js\",\"878\",\"static/chunks/app/(app)/posts/%5Bid%5D/page-6bb6cd9ad97d098b.js\"],\"default\"]\n9:I[1473,[],\"\"]\nb:I[9658,[],\"\"]\nc:I[3205,[\"779\",\"static/chunks/779-ad4ead70309b9a20.js\",\"739\",\"static/chunks/739-1be71c4fce382004.js\",\"138\",\"static/chunks/138-7f27ef5cd2caf4b4.js\",\"531\",\"static/chunks/531-f976d425ce9a81a1.js\",\"103\",\"static/chunks/103-1875d9378f90876a.js\",\"868\",\"static/chunks/868-9c31f7c0009643d5.js\",\"814\",\"static/chunks/app/(app)/layout-66a850f3e6447c7d.js\"],\"GlobalBg\"]\nd:I[7726,[\"779\",\"static/chunks/779-ad4ead70309b9a20.js\",\"739\",\"static/chunks/739-1be71c4fce382004.js\",\"138\",\"static/chunks/138-7f27ef5cd2caf4b4.js\",\"531\",\"static/chunks/531-f976d425ce9a81a1.js\",\"103\",\"static/chunks/103-1875d9378f90876a.js\",\"868\",\"static/chunks/868-9c31f7c0009643d5.js\",\"814\",\"static/chunks/app/(app)/layout-66a850f3e6447c7d.js\"],\"Head"])</script><script>self.__next_f.push([1,"er\"]\ne:\"$Sreact.suspense\"\nf:I[4662,[\"779\",\"static/chunks/779-ad4ead70309b9a20.js\",\"739\",\"static/chunks/739-1be71c4fce382004.js\",\"138\",\"static/chunks/138-7f27ef5cd2caf4b4.js\",\"531\",\"static/chunks/531-f976d425ce9a81a1.js\",\"103\",\"static/chunks/103-1875d9378f90876a.js\",\"868\",\"static/chunks/868-9c31f7c0009643d5.js\",\"814\",\"static/chunks/app/(app)/layout-66a850f3e6447c7d.js\"],\"PeekabooLink\"]\n10:I[4543,[\"779\",\"static/chunks/779-ad4ead70309b9a20.js\",\"739\",\"static/chunks/739-1be71c4fce382004.js\",\"138\",\"static/chunks/138-7f27ef5cd2caf4b4.js\",\"857\",\"static/chunks/857-68a2fd358cb70760.js\",\"594\",\"static/chunks/594-71c3251836d38f7c.js\",\"878\",\"static/chunks/app/(app)/posts/%5Bid%5D/page-6bb6cd9ad97d098b.js\"],\"Image\"]\n11:I[2962,[\"245\",\"static/chunks/245-4d9cc7d916e46c69.js\",\"857\",\"static/chunks/857-68a2fd358cb70760.js\",\"185\",\"static/chunks/app/layout-d7953313cc6bdbf6.js\"],\"default\"]\n12:I[7808,[\"245\",\"static/chunks/245-4d9cc7d916e46c69.js\",\"857\",\"static/chunks/857-68a2fd358cb70760.js\",\"185\",\"static/chunks/app/layout-d7953313cc6bdbf6.js\"],\"default\"]\n13:I[5433,[\"245\",\"static/chunks/245-4d9cc7d916e46c69.js\",\"857\",\"static/chunks/857-68a2fd358cb70760.js\",\"185\",\"static/chunks/app/layout-d7953313cc6bdbf6.js\"],\"ThemeProvider\"]\n14:I[3970,[\"779\",\"static/chunks/779-ad4ead70309b9a20.js\",\"739\",\"static/chunks/739-1be71c4fce382004.js\",\"160\",\"static/chunks/app/not-found-8b889a2f44e80cbe.js\"],\"default\"]\n16:I[2716,[],\"\"]\na:[\"id\",\"post-20\",\"d\"]\n17:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/docs/_next/static/css/8cd2eb158671e11e.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"weVExY6-jENQW9lG_RHEX\",\"assetPrefix\":\"/docs\",\"initialCanonicalUrl\":\"/posts/post-20\",\"initialTree\":[\"\",{\"children\":[\"(app)\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"post-20\",\"d\"],{\"children\":[\"__PAGE__?{\\\"id\\\":\\\"post-20\\\"}\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"(app)\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"post-20\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",[\"$\",\"div\",null,{\"className\":\"sm:px-8 mt-10 lg:mt-16\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-7xl lg:px-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"relative px-4 sm:px-8 lg:px-12 !px-0\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-2xl lg:max-w-5xl\",\"children\":[\"$\",\"div\",null,{\"className\":\"w-full md:flex md:justify-between xl:relative gap-1\",\"children\":[[\"$\",\"aside\",null,{\"className\":\"hidden w-[160px] shrink-0 lg:block\",\"children\":[\"$\",\"div\",null,{\"className\":\"sticky top-2 pt-16\",\"children\":[\"$\",\"$L5\",null,{}]}]}],[\"$\",\"div\",null,{\"className\":\"max-w-4xl md:flex-1 md:shrink-0 \",\"children\":[[\"$\",\"$L6\",null,{\"href\":\"/posts\",\"className\":\"group mb-8 flex h-10 w-10 items-center justify-center bg-white dark:border dark:border-zinc-700/50 dark:bg-zinc-800 dark:ring-0 dark:hover:border-zinc-700 lg:absolute lg:-left-5 lg:-mt-2 lg:mb-0 xl:-top-1.5 xl:left-0 xl:mt-0 group rounded-full bg-gradient-to-b from-zinc-50/50 to-white/90 px-3 py-2 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur transition dark:from-zinc-900/50 dark:to-zinc-800/90 dark:ring-white/10 dark:hover:ring-white/20\",\"aria-label\":\"返回博客页面\",\"children\":[\"$\",\"svg\",null,{\"width\":\"1em\",\"height\":\"1em\",\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"className\":\"h-8 w-8 stroke-zinc-500 transition group-hover:stroke-zinc-700 dark:stroke-zinc-500 dark:group-hover:stroke-zinc-400\",\"children\":[\"$\",\"path\",null,{\"d\":\"M8.03089 4C6.57669 5.05865 5.2706 6.29537 4.14485 7.67887C4.04828 7.79755 4 7.94044 4 8.08333M8.03089 12.1667C6.57669 11.108 5.2706 9.8713 4.14485 8.4878C4.04828 8.36912 4 8.22623 4 8.08333M4 8.08333H14.963C17.7448 8.08333 20 10.3033 20 13.0417C20 15.7801 17.7448 18 14.963 18H12\",\"stroke\":\"currentColor\",\"strokeWidth\":\"2\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\"}]}]}],[\"$\",\"article\",null,{\"data-postid\":\"data/blog/post-20.mdx\",\"className\":\"rich-text-viewer prose px-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-8 text-center\",\"children\":[\"$undefined\",[\"$\",\"h1\",null,{\"className\":\"text-3xl font-bold\",\"children\":\"DOM元素导出图片与PDF：多种方案对比与实现\"}],[\"$\",\"div\",null,{\"className\":\"flex justify-center rounded-md  h-5 items-center space-x-4 text-sm\",\"children\":[[\"$\",\"time\",null,{\"dateTime\":\"2024-09-27T08:27:42.000Z\",\"className\":\"mb-1 text-xs text-gray-600\",\"children\":\"2024-09-27\"}],[\"$\",\"$L7\",null,{\"orientation\":\"vertical\"}],[\"$\",\"span\",null,{\"className\":\"mb-1 text-xs text-gray-600 flex items-center\",\"children\":[[\"$\",\"svg\",null,{\"width\":\"1em\",\"height\":\"1em\",\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"className\":\"mr-2\",\"children\":[\"$\",\"path\",null,{\"d\":\"M10.1912 12.5508C10.3071 12.1942 10.3071 11.8058 10.1912 11.4492C9.22165 8.46673 4.40272 8.00546 4.01443 4.48436C3.93458 3.76031 4.18955 3.04013 4.69671 2.55723C5.28193 2 6.62415 2 9.30861 2H14.6914C17.3759 2 18.7181 2 19.3033 2.55723C19.8104 3.04013 20.0654 3.76031 19.9856 4.48436C19.5973 8.00546 14.7784 8.46673 13.8088 11.4492C13.6929 11.8058 13.6929 12.1942 13.8088 12.5508C14.7784 15.5333 19.5973 15.9945 19.9856 19.5156C20.0654 20.2397 19.8104 20.9599 19.3033 21.4428C18.7181 22 17.3758 22 14.6914 22L9.3086 22C6.62415 22 5.28192 22 4.69671 21.4428C4.18955 20.9599 3.93458 20.2397 4.01442 19.5156C4.40272 15.9945 9.22164 15.5333 10.1912 12.5508Z\",\"stroke\":\"currentColor\",\"strokeWidth\":\"2\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\"}]}],\" \",28,\" 分钟\"]}]]}],[\"$\",\"div\",null,{\"className\":\"flex w-full justify-center gap-2 mt-2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"inline-flex items-center px-2 h-5 rounded-md text-xs  bg-gray-300 text-gray-800\",\"children\":\"pdf 生成\"}],[\"$\",\"span\",null,{\"className\":\"inline-flex items-center px-2 h-5 rounded-md text-xs  bg-gray-300 text-gray-800\",\"children\":\"png 导出\"}]]}],\"$undefined\"]}],[\"$\",\"div\",null,{\"className\":\"js-toc-content\",\"children\":[[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"文章详细介绍了将 HTML DOM 元素转换为图片或 PDF 的多种方法，包括使用 html2canvas、dom-to-image、Puppeteer 和 canvas原生绘制等技术。文章分析了每种方法的实现过程、使用场景、优缺点，并提供了代码示例，帮助开发者根据具体需求选择合适的解决方案。\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"背景\",\"children\":[\"$\",\"a\",null,{\"className\":\"anchor\",\"href\":\"#背景\",\"children\":\"背景\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"在日常前端开发中，经常会有把页面的 DOM 元素作为 PNG 或者 PDF 下载到本地的需求。例如海报功能，简历导出功能等等。在我们自家的产品「代码小抄」中，就使用了 html2canvas 来实现代码片段导出为图片：\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"$L8\",null,{\"src\":\"https://blog-1304565468.cos.ap-shanghai.myqcloud.com/work/1727341488075-bbfc29ea-5579-4a91-aa6d-6e9ae1f31f9e.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"是不是还行，大家如果想要分享代码片段，可以试试，非常好用。那有哪些方法可以实现下载 DOM 元素到本地呢？目前收集到的有：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"通过 html2canvas 、dom-to-image 等第三方库实现\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"通过 Puppeteer 启动一个 node 服务实现\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"canvas 原生绘制\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"这些方式是真实项目会使用的方式，针对不同场景可以使用不同的方法，下面看一下每种方法如何实现、使用场景和优缺点，\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"方案-1---html2canvas\",\"children\":[\"$\",\"a\",null,{\"className\":\"anchor\",\"href\":\"#方案-1---html2canvas\",\"children\":\"方案 1 - html2canvas\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"html2canvas 专门用于解析 DOM 结构及其关联的 CSS 样式，进而将网页内容渲染为 Canvas 元素的 JavaScript 库，下面是下载元素为 PNG 的示例代码：\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-typescript\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-typescript code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"/**\\r\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\" * 下载 dom 元素为图片\\r\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\" * @param elementId DOM 元素id\\r\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\" * @param fileName 下载图片的文件名\\r\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\" * @returns\\r\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\" */\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function-variable function\",\"children\":\"downloadDOMElementAsImage\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"elementId\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" fileName\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" element \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" document\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getElementById\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"elementId\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"as\"}],\" HTMLElement\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"element\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" message\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"warn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'无法找到 DOM 元素'\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"try\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 将 DOM 元素转换为 canvas\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" canvas \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"html2canvas\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"element\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      useCORS\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      allowTaint\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 提高清晰度\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      scale\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      backgroundColor\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'transparent'\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 将 canvas 转换为数据 URL\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" dataUrl \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" canvas\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"toDataURL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'image/png'\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 创建一个临时的 \u003ca\u003e 元素，设置其 href 为数据 URL 并设置 download 属性\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" link \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" document\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"createElement\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'a'\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    link\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"style\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"visibility \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'hidden'\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    link\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"href \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" dataUrl\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    link\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"download \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" fileName\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 将 \u003ca\u003e 元素添加到 DOM，触发点击事件，然后从 DOM 中移除\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    document\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"body\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"appendChild\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"link\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    link\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"click\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    document\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"body\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"removeChild\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"link\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"catch\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"error\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"any\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    message\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"error\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'无法将 DOM 元素转换为图片并下载'\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" error\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  element\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"style\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"transform \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'scale(1)'\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"通过 html2canvas ，我们封装了一个下载页面 DOM 为图片的方法，然后就可以很方便的调用方法进行页面元素的下载\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"使用场景\",\"children\":[\"$\",\"a\",null,{\"className\":\"anchor\",\"href\":\"#使用场景\",\"children\":\"使用场景\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"适用于需要将复杂的 DOM 结构（包括样式、背景图像、字体等）渲染为图片的场景。它可以捕获大部分 CSS 样式和 HTML 内容\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"优缺点\",\"children\":[\"$\",\"a\",null,{\"className\":\"anchor\",\"href\":\"#优缺点\",\"children\":\"优缺点\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"优点：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"使用非常简单，支持大多数 css\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"内置跨域解决方案\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"可以通过 ignoreElements 过滤指定 DOM，这在处理\",[\"$\",\"strong\",null,{\"children\":\"复杂 DOM 结构\"}],\"的时候非常有用\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"缺点：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"下载的图可能不清晰\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"库比较大\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"计算耗时，性能不好\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"部分特殊的样式可能不支持，存在兼容性问题\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"方案-2---dom-to-image\",\"children\":[\"$\",\"a\",null,{\"className\":\"anchor\",\"href\":\"#方案-2---dom-to-image\",\"children\":\"方案 2 - dom-to-image\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"dom-to-image 是一个用 JavaScript 编写的库，可以将任意 DOM 节点转换为矢量（SVG）或光栅（PNG 或 JPEG）图像。它和 html2canvas 一样也是基于 canvas 封装的库。看一下生成 PNG 的示例代码：\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-typescript\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-typescript code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"/**\\r\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\" * 下载 DOM 元素为高质量图片\\r\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\" * @param elementId DOM 元素id\\r\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\" * @param fileName 下载图片的文件名\\r\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\" * @param sc 缩放比\\r\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\" * @returns\\r\\n\"}]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\" */\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function-variable function\",\"children\":\"downloadDOMElementAsImage\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"elementId\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" fileName\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" sc \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" element \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" document\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getElementById\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"elementId\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"as\"}],\" HTMLElement\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"element \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"||\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"window \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"||\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"document\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" message\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"warning\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"无法找到 DOM 元素\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" messageKey \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"loading\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  message\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"loading\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    content\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"正在下载...\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    duration\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    key\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" messageKey\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"try\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" clone \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" element\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"cloneNode\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"as\"}],\" HTMLElement\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    document\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"body\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"appendChild\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"clone\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 临时增加元素尺寸以提高分辨率\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" originalWidth \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" element\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"offsetWidth\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" originalHeight \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" element\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"offsetHeight\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" scale \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" sc\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 增加缩放因子以提高分辨率\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 设置相对定位，zIndex 为 -1\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    clone\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"style\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"position \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"relative\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// clone.style.zIndex = \\\"-1\\\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    clone\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"style\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"transform \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token template-string\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"scale(\"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"$${\"}],\"scale\",[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    clone\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"style\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"transformOrigin \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"top left\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" dataUrl \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"await\"}],\" domtoimage\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"toPng\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"clone\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      width\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" originalWidth \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\" scale\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      height\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" originalHeight \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\" scale\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      style\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        transform\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token template-string\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"scale(\"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"$${\"}],\"scale\",[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        transformOrigin\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"top left\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        width\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token template-string\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"$${\"}],\"originalWidth\",[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"px\"}],[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        height\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token template-string\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"$${\"}],\"originalHeight\",[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"px\"}],[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      cacheBust\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      quality\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      bgcolor\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"transparent\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 创建下载链接\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" link \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" document\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"createElement\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"a\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    link\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"href \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" dataUrl\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    link\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"download \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" fileName\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    document\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"body\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"appendChild\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"link\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    link\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"click\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    document\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"body\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"removeChild\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"link\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    message\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"destroy\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"messageKey\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setTimeout\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      document\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"body\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"removeChild\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"clone\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"500\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"catch\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"any\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    message\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"destroy\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"messageKey\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"console\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"error\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"下载失败\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"message\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    message\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"error\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"下载失败: \\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"message\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"可以看到使用也非常简单，我们可以通过 sc 参数来控制下载图片的清晰度和大小。\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"使用场景-1\",\"children\":[\"$\",\"a\",null,{\"className\":\"anchor\",\"href\":\"#使用场景-1\",\"children\":\"使用场景\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"如果对项目大小有要求，希望文本排版支持度高，需要稳定的文字、图片渲染能力或者处理结构化数据的能力，可以使用 dom-to-image\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"优缺点-1\",\"children\":[\"$\",\"a\",null,{\"className\":\"anchor\",\"href\":\"#优缺点-1\",\"children\":\"优缺点\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"优点：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"库比较轻量\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"适用于需要多格式导出的场景\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"缺点：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"需要手动处理跨域\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"方案-31---puppeteer\",\"children\":[\"$\",\"a\",null,{\"className\":\"anchor\",\"href\":\"#方案-31---puppeteer\",\"children\":\"方案 3.1 - Puppeteer\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"上面两种方法虽然可以在 web 端生成图片，但是如果需要：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"兼容多端，\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"同时支持生成 PNG 和 PDF，并且要求非常清晰，\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"兼容图片跨域\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"兼容所有 css\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"对项目体积有要求\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"那我们就可以使用 Puppeteer 来实现，它可以解决上面所有的问题。Puppeteer 是一个强大的 Node.js 库，用于控制 Chrome 或 Chromium 浏览器来帮我们生成想要的 PNG 或者 PDF，下面我们就使用 express + Puppeteer 来快速实现一个图片下载服务：\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-javascript\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-javascript code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// node 服务 app.js 示例代码\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token imports\",\"children\":\"cors\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"cors\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token imports\",\"children\":\"express\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"express\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token imports\",\"children\":\"puppeteer\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"puppeteer\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" app \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"express\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"use\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"cors\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"use\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"express\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"json\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"get\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"/\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":[\"req\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" res\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token arrow operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"send\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"面试刷题，我只用面试鸭~\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"post\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"/download\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":[\"req\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" res\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token arrow operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" url\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" quality\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" format\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" filename\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" domId\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" type \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" req\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"body\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"url \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"||\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"filename \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"||\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"domId \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"||\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"type\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"return\"}],\" res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"status\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"400\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"send\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Missing required parameters\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"try\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 启动浏览器\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" browser \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" puppeteer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"launch\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 新建一个页面\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" page \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" browser\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"newPage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 设置默认一分钟超时\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" page\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"setDefaultNavigationTimeout\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"60000\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 打开页面\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" page\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"goto\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"url\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"waitUntil\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"networkidle0\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"type \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"===\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"png\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 等待元素加载\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" page\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"waitForSelector\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token template-string\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"#\"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"$${\"}],\"domId\",[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 等待元素加载\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" page\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"waitForSelector\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token template-string\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"#\"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"$${\"}],\"domId\",[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 截取指定元素的截图\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" element \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" page\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"$$\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token template-string\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"#\"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"$${\"}],\"domId\",[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token console class-name\",\"children\":\"console\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"log\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"element\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"element\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" imageBuffer \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" element\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"screenshot\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"type\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"jpeg\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"quality\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"parseInt\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"quality\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 仅适用于 jpeg\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// omitBackground: true,\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" browser\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"close\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"contentType\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"image/jpeg\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"attachment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"filename \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\".jpeg\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 返回二进制数据给前端\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"send\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Buffer\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"from\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"imageBuffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"binary\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"else\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"type \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"===\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"pdf\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" pdf \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" page\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"pdf\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"format\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" format \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"||\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"A4\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"printBackground\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"pageRanges\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"1-\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"req\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"body\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"pages\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"||\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"1\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"contentType\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"application/pdf\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"attachment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"resume.pdf\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 返回二进制数据给前端\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"send\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Buffer\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"from\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"pdf\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"else\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"status\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"400\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"send\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Invalid type\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" browser\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"close\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"catch\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"error\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token console class-name\",\"children\":\"console\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"error\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"error\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"status\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"500\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"send\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Internal Server Error\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"PORT\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3001\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"listen\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"PORT\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token arrow operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token console class-name\",\"children\":\"console\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"log\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token template-string\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"Server is running on http://localhost:\"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"$${\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"PORT\"}],[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"通过 Puppeteer 我们可以很方便的进行屏幕截取，因为它就是通过游览器内核来实现，所以它能完全还原展示效果\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"使用场景-2\",\"children\":[\"$\",\"a\",null,{\"className\":\"anchor\",\"href\":\"#使用场景-2\",\"children\":\"使用场景\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"如果需要下载图片和 PDF，对图片清晰度还有要求，页面元素还比较复杂，生成图片和 PDF 需要多端支持等等，可以使用 Puppeteer 来实现\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"优缺点-2\",\"children\":[\"$\",\"a\",null,{\"className\":\"anchor\",\"href\":\"#优缺点-2\",\"children\":\"优缺点\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"优点：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"高度还原视图：Puppeteer 使用的是无头 Chrome 浏览器，所以它生成的 PDF 和截图与用户在浏览器中看到的内容几乎完全一致\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"丰富的 API： Puppeteer 提供了超多 API，基本可以解决所有遇到的问题，相关文档地址：\",[\"$\",\"a\",null,{\"href\":\"https://github.com/puppeteer/puppeteer/blob/v1.5.0/docs/api.md\",\"children\":\"https://github.com/puppeteer/puppeteer/blob/v1.5.0/docs/api.md\"}],\"，非常多的 API\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"支持最新的 css：由于 Puppeteer 使用的是 Chrome 浏览器，它支持所有现代 Web 特性，因此它在处理复杂网页时非常有优势\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"跨域资源支持： Puppeteer 通常以无头模式运行，这种模式下浏览器跨域访问的限制会放宽\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"缺点：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"需要部署服务：Puppeteer 需要在服务器端运行，需要一个后端环境来支持它。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"资源消耗大： 由于 Puppeteer 启动的是一个完整的 Chrome 浏览器实例，因此它的资源消耗相对较大，可能会影响服务器的性能\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"额外的学习成本：如果团队都对 Puppeteer 不了解，可能需要额外的学习和维护成本\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"但是如果使用 Puppeteer 去生产环境使用，可能还会有同时处理大量请求导致服务资源被消耗光，甚至导致下载服务奔溃的情况，这时候我们就可以使用 puppeteer-cluster 来实现请求队列， 使用队列系统来管理请求，确保同时只处理一定数量的请求，其他请求则排队等待\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"方案-32---puppeteer-cluster\",\"children\":[\"$\",\"a\",null,{\"className\":\"anchor\",\"href\":\"#方案-32---puppeteer-cluster\",\"children\":\"方案 3.2 - puppeteer-cluster\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"代码示例：\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-javascript\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-javascript code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 源码：https://github.com/chaseFunny/pdf-png-downloader\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token imports\",\"children\":\"cors\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"cors\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token imports\",\"children\":\"express\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"express\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token imports\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Cluster\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"puppeteer-cluster\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" app \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"express\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"use\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"cors\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"use\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"express\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"json\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" cluster\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 初始化 cluster\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"initCluster\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  cluster \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Cluster\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"launch\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"concurrency\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Cluster\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"CONCURRENCY_CONTEXT\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"maxConcurrency\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 最大并发数,可以根据服务器资源调整\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"puppeteerOptions\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"headless\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"args\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"--no-sandbox\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"--disable-setuid-sandbox\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 定义任务处理函数\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" cluster\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"task\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" page\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"data\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" url\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" domId\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" type\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" quality\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" format\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" pages \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token arrow operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" page\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"goto\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"url\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"waitUntil\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"networkidle0\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"type \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"===\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"png\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" page\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"waitForSelector\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token template-string\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"#\"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"$${\"}],\"domId\",[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" element \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" page\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"$$\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token template-string\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"#\"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"$${\"}],\"domId\",[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" element\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"screenshot\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"type\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"jpeg\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"quality\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"parseInt\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"quality\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"else\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"type \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"===\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"pdf\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" page\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"pdf\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"format\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" format \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"||\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"A4\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"printBackground\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"pageRanges\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"1-\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"pages \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"||\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"1\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token console class-name\",\"children\":\"console\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"log\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Cluster initialized\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"initCluster\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"get\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"/\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":[\"req\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" res\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token arrow operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"send\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"面试刷题，我只用面试鸭~\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"post\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"/download\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token parameter\",\"children\":[\"req\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" res\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token arrow operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" url\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" quality\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" format\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" filename\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" domId\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" type\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" pages \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" req\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"body\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"url \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"||\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"filename \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"||\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"domId \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"||\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"type\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"return\"}],\" res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"status\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"400\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"send\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Missing required parameters\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"try\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" result \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" cluster\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"execute\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" url\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" domId\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" type\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" quality\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" format\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" pages \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"type \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"===\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"png\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"contentType\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"image/png\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"attachment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"filename \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\".png\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"send\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Buffer\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"from\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"result\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"else\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"type \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"===\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"pdf\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"contentType\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"application/pdf\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"attachment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"filename \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\".pdf\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"send\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Buffer\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"from\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"result\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"else\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"status\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"400\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"send\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Invalid type\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"catch\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"error\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token console class-name\",\"children\":\"console\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"error\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"error\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    res\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"status\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"500\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"send\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Internal Server Error\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"PORT\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3001\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"listen\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"PORT\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token arrow operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token console class-name\",\"children\":\"console\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"log\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token template-string\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"Server is running on http://localhost:\"}],[\"$\",\"span\",null,{\"className\":\"token interpolation\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"$${\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"PORT\"}],[\"$\",\"span\",null,{\"className\":\"token interpolation-punctuation punctuation\",\"children\":\"}\"}]]}],[\"$\",\"span\",null,{\"className\":\"token template-punctuation string\",\"children\":\"`\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 优雅关闭\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"process\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"on\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"SIGINT\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token arrow operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token console class-name\",\"children\":\"console\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"log\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Closing cluster...\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"await\"}],\" cluster\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"close\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  process\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"exit\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"我们使用 puppeteer-cluster 创建了一个浏览器实例池，有如下优点：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"可以更有效地处理并发请求，它会自动把接受的请求加入队列，保证所有请求都会进行处理。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"将 PDF 和 PNG 生成的逻辑移到了 cluster.task 中，这样可以重用浏览器实例，提高效率\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"设置了最大并发数（maxConcurrency），可以根据服务器资源进行调整,避免资源耗尽\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"**注意：**在生产环境，我们可能需要在 puppeteerOptions 的 executablePath 设置具体的 chrome 路径，保证服务能找到 chorme\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"方案-4---canvas-原生绘制\",\"children\":[\"$\",\"a\",null,{\"className\":\"anchor\",\"href\":\"#方案-4---canvas-原生绘制\",\"children\":\"方案 4 - canvas 原生绘制\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"参考代码：\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-javascript\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-javascript code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"//获取canvas元素\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"var\"}],\" canvas \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token dom variable\",\"children\":\"document\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"getElementById\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'poster'\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"var\"}],\" ctx \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" canvas \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getContext\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'2d'\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 设置canvas宽高\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"canvas\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"width\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"600\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"canvas\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"height\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"800\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 绘制背景\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"fillStyle\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'#ff6600'\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"fillRect\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" canvas\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"width\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" canvas\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"height\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 绘制文字\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"font\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'bold 48px Arial'\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"fillStyle\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" '#ffffff•\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"textAlign\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'center'\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"fillText\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'*HEd'\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" canvas\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"width\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"120\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ctx\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"font \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'24px Arial'\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"fillText（\"}],\"'这里是副标题\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"canvas\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"width\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"180\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 绘制图片\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"var\"}],\" img \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Image\"}],\"（）\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"img\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token method-variable function-variable method function property-access\",\"children\":\"onload\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"｛\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token method function property-access\",\"children\":\"drawImage\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"img\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"100\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"250\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"400\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"400\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\r\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"｝\\r\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"img\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"src\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"'图片地址'\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"canvas 虽然高性能，但是工作量大，一般生产环境不会使用\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"总结\",\"children\":[\"$\",\"a\",null,{\"className\":\"anchor\",\"href\":\"#总结\",\"children\":\"总结\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"在实际开发中，面对不同场景我们会使用不同的方案，那我们公司的线上项目为例：在我们的「面试鸭」和「编程导航」的生成海报功能都是使用了 html2canvas 来生成海报，因为它要比 Puppeteer 快，能够让用户更快拿到海报图，在「老鱼简历」中，我们使用 Puppeteer 来导出简历，这样导出的简历和看到的更加一致，并且清晰度更加高。\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"上面的代码都在仓库：\",[\"$\",\"a\",null,{\"href\":\"https://github.com/chaseFunny/pdf-png-downloader\",\"children\":\"https://github.com/chaseFunny/pdf-png-downloader\"}],\"，还提供了简单的页面方便大家体验调试\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"$L8\",null,{\"src\":\"https://blog-1304565468.cos.ap-shanghai.myqcloud.com/work/1727149024893-6a7e02ec-7575-498f-bf65-7b0234d1f117.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"此文自动发布于：\",[\"$\",\"a\",null,{\"href\":\"https://github.com/coderPerseus/blog/issues/20\",\"target\":\"_blank\",\"children\":\"github issues\"}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"flex px-4 justify-between mt-8\",\"children\":[[\"$\",\"$L6\",null,{\"href\":\"/posts/post-21\",\"className\":\"inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium text-violet-500 dark:text-violet-300 shadow-sm hover:bg-violet-200 dark:hover:bg-violet-500 focus:outline-none focus:ring-2 focus:ring-violet-600 focus:ring-offset-2\",\"children\":\"LLM RAG （大语言模型检索增强生成...\"}],[\"$\",\"$L6\",null,{\"href\":\"/posts/post-19\",\"className\":\"inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium text-violet-500 dark:text-violet-300 shadow-sm hover:bg-violet-200 dark:hover:bg-violet-500 focus:outline-none focus:ring-2 focus:ring-violet-600 focus:ring-offset-2\",\"children\":\"Taro3 + react 项目如何使用...\"}]]}]]}]]}]}]}]}]}]],null],null]},[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(app)\",\"children\",\"posts\",\"children\",\"$a\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/docs/_next/static/css/cc5160e2067b0cef.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]}],[[\"$\",\"div\",null,{\"className\":\"sm:px-8 relative mt-16 min-h-screen lg:mt-32\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-7xl lg:px-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"relative px-4 sm:px-8 lg:px-12\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-2xl lg:max-w-5xl\",\"children\":[\"$\",\"div\",null,{\"className\":\"absolute inset-0 flex items-center justify-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"animate-pulse text-5xl text-zinc-500/50\",\"children\":[\"$\",\"svg\",null,{\"width\":\"1em\",\"height\":\"1em\",\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[\"$\",\"path\",null,{\"d\":\"M16.5609 7.43931C15.7777 5.41156 14.0301 4 12 4C9.96987 4 8.22234 5.41156 7.43913 7.43931M16.5609 7.43931C19.7904 8.10251 22 9.44804 22 11C22 13.2091 17.5228 15 12 15C6.47715 15 2 13.2091 2 11C2 9.44804 4.20962 8.10251 7.43913 7.43931M16.5609 7.43931C16.94 8.42085 17.0719 9.49351 16.9638 10.5391C15.5011 10.8323 13.8065 11 12 11C10.1935 11 8.49887 10.8323 7.03622 10.5391C6.92815 9.49351 7.06001 8.42085 7.43913 7.43931M4 17L3 19M12 18V21M20 17L21 19\",\"stroke\":\"currentColor\",\"strokeWidth\":\"2\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\"}]}]}]}]}]}]}]}],[],[]]]},[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(app)\",\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[[\"$\",\"$Lc\",null,{}],[\"$\",\"div\",null,{\"className\":\"fixed inset-0 flex justify-center sm:px-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex w-full max-w-7xl lg:px-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"opacity-95 w-full bg-zinc-50/90 ring-1 ring-zinc-100 dark:bg-zinc-900/80 dark:ring-zinc-400/20\"}]}]}],[\"$\",\"div\",null,{\"className\":\"relative text-zinc-800 dark:text-zinc-200\",\"children\":[[\"$\",\"$Ld\",null,{}],[\"$\",\"main\",null,{\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(app)\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]}],[\"$\",\"$e\",null,{\"children\":[\"$\",\"footer\",null,{\"className\":\"mt-32\",\"children\":[\"$\",\"div\",null,{\"className\":\"sm:px-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-7xl lg:px-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"border-t border-zinc-100 pb-16 pt-10 dark:border-zinc-700/40\",\"children\":[[\"$\",\"div\",null,{\"className\":\"relative px-4 sm:px-8 lg:px-12\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-2xl lg:max-w-5xl\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center justify-between gap-6 sm:flex-row\",\"children\":[[\"$\",\"p\",null,{\"className\":\"text-sm text-zinc-500/80 dark:text-zinc-400/80\",\"children\":[\"© \",2025,\" \",\"William Sun\",\" 网站已开源：\",[\"$\",\"$Lf\",null,{\"href\":\"https://github.com/coderPerseus/blog\",\"children\":\"William Sun\"}]]}],[\"$\",\"nav\",null,{\"className\":\"flex gap-6 text-sm font-medium text-zinc-800 dark:text-zinc-200\",\"children\":[[\"$\",\"$L6\",null,{\"href\":\"/\",\"className\":\"transition hover:text-violet-500 dark:hover:text-violet-400\",\"children\":\"首页\"}],[\"$\",\"$L6\",null,{\"href\":\"/posts\",\"className\":\"transition hover:text-violet-500 dark:hover:text-violet-400\",\"children\":\"博客\"}],[\"$\",\"$L6\",null,{\"href\":\"/about\",\"className\":\"transition hover:text-violet-500 dark:hover:text-violet-400\",\"children\":\"关于我\"}]]}]]}]}]}],[\"$\",\"div\",null,{\"className\":\"relative px-4 sm:px-8 lg:px-12 mt-6\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-2xl lg:max-w-5xl\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center justify-start gap-2 sm:flex-row\",\"children\":\"欢迎 👏🏻 你的访问\"}]}]}],[\"$\",\"div\",null,{\"className\":\"flex justify-center p-6 flex-col sm:flex-row\",\"children\":[[\"$\",\"$L6\",null,{\"target\":\"_blank\",\"href\":\"https://beian.miit.gov.cn/\",\"className\":\"text-blue-600 flex justify-center items-center\",\"children\":[[\"$\",\"$L10\",null,{\"unoptimized\":true,\"src\":\"/docs/police.png\",\"width\":18,\"height\":18,\"alt\":\"备案\",\"className\":\"mr-1 \"}],\"辽公网安备21021202000334号\"]}],[\"$\",\"$L6\",null,{\"target\":\"_blank\",\"href\":\"https://beian.miit.gov.cn/\",\"className\":\"text-blue-600 pl-6 flex justify-center items-center\",\"children\":\"辽ICP备2021012379号-1\"}]]}]]}]}]}]}]}]]}]],null],null]},[[\"$\",\"html\",null,{\"className\":\" m-0 h-full p-0 font-sans antialiased\",\"lang\":\"zh-CN\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"children\":[[\"$\",\"$L11\",null,{}],[\"$\",\"$L12\",null,{}],[\"$\",\"$L13\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"$L14\",null,{}],\"notFoundStyles\":[],\"styles\":null}]}]]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$L15\"],\"globalErrorComponent\":\"$16\",\"missingSlots\":\"$W17\"}]]\n"])</script><script>self.__next_f.push([1,"15:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"#000212\"}],[\"$\",\"meta\",\"2\",{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"#fafafa\"}],[\"$\",\"meta\",\"3\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"4\",{\"children\":\"DOM元素导出图片与PDF：多种方案对比与实现 | William Sun\"}],[\"$\",\"meta\",\"5\",{\"name\":\"description\",\"content\":\"DOM元素导出图片与PDF：多种方案对比与实现 - William Sun\"}],[\"$\",\"link\",\"6\",{\"rel\":\"manifest\",\"href\":\"/site.webmanifest\",\"crossOrigin\":\"use-credentials\"}],[\"$\",\"meta\",\"7\",{\"name\":\"keywords\",\"content\":\"pdf 生成,png 导出\"}],[\"$\",\"meta\",\"8\",{\"name\":\"baidu-site-verification\",\"content\":\"codeva-7AmpPWgzQY\"}],[\"$\",\"meta\",\"9\",{\"name\":\"google-site-verification\",\"content\":\"TTbfOvWmLj0icfk0BQNUZB3crwReji82Q_vRdnZFFAc\"}],[\"$\",\"link\",\"10\",{\"rel\":\"canonical\",\"href\":\"https://dhc.ink/posts/post-20\"}],[\"$\",\"link\",\"11\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"title\":\"RSS 订阅\",\"href\":\"https://luckysnail.cn/rss\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:title\",\"content\":\"DOM元素导出图片与PDF：多种方案对比与实现\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:description\",\"content\":\"DOM元素导出图片与PDF：多种方案对比与实现 - William Sun\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"15\",{\"name\":\"twitter:creator\",\"content\":\"@haozhan05554957\"}],[\"$\",\"meta\",\"16\",{\"name\":\"twitter:title\",\"content\":\"William Sunblog | 前端 | 开发者\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:description\",\"content\":\"我是William Sun，一名充满热情的前端开发工程师。我热衷于探索和体验最新技术，特别是人工智能（AI），并在日常工作中去使用它们，来提升我的工作效率。我的目标是积极参与开源社区，为开源项目贡献自己的力量。正如我的名字，我相信越努力，越幸运\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:image\",\"content\":\"https://luckysnail.cn/og.png\"}],[\"$\",\"link\",\"19\",{\"rel\":\"icon\",\"href\":\"/docs/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"32x32\"}],[\"$\",\"link\",\"20\",{\"rel\":\"icon\",\"href\":\"/docs/icon.jpg?021a5ddd40907a91\",\"type\":\"image/jpeg\",\"sizes\":\"256x256\"}],[\"$\",\"link\",\"21\",{\"rel\":\"apple-touch-icon\",\"href\":\"/docs/apple-icon.jpg?58f0c05bf91c4519\",\"type\":\"image/jpeg\",\"sizes\":\"1022x1023\"}]]\n"])</script><script>self.__next_f.push([1,"4:null\n"])</script></body></html>