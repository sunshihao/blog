---
title: ä½¿ç”¨å­—èŠ‚çš„ TRAE å¼€å‘ä¸€ä¸ªç®€å•çš„ node æœåŠ¡
date: 2025-01-21T04:12:35Z
slug: post-44
author: chaseFunnyï¼šhttps://github.com/chaseFunny
tags: ["AI","ç¼–è¾‘å™¨"]
---

![ofXcwflHCsxf](https://blog-1304565468.cos.ap-shanghai.myqcloud.com/work/ofXcwflHCsxf.png)

å¤§å®¶å¥½æˆ‘æ˜¯ luckySnailã€‚åœ¨æµè§ˆæµåª’ä½“çš„æ—¶å€™ï¼Œå‘ç°éƒ½åœ¨æ¨èè¿™ä¸ªå·¥å…·ï¼Œå­—èŠ‚åˆšåˆšå‘å¸ƒäº† AI ç¼–è¾‘å™¨ - TRAEï¼ˆThe Real AI Engineerï¼‰ï¼ŒçœŸæ­£çš„ AI å¼•æ“å—ï¼Ÿï¼Œå¿…é¡»èµ¶ç´§ä½“éªŒä¸€æ³¢ï¼Œåˆšå¥½æƒ³è¦å¼€å‘ä¸€ä¸ªå°å·¥å…·ï¼Œå¸Œæœ›å®ƒä¸è¦è®©æˆ‘å¤±æœ›ã€‚å·å·è¯´ä¸€ä¸‹å®ƒå·²ç»è®© windows ç”¨æˆ·å¤±æœ›äº†ï¼Œå› ä¸ºå®ƒç›®å‰ä»…æ”¯æŒ mac ç”µè„‘ã€‚ä½ å¯ä»¥çœ‹å†´ç¾½çš„è¿™ç¯‡äº†è§£TRAEï¼šhttps://juejin.cn/post/7461825527059611686 

## åˆä½“éªŒ

è®©æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¸ºä»€ä¹ˆå«è¿™ä¸ªåå­—ï¼Œæ¥ä¸‹æ¥ä½ å°±çŸ¥é“äº†ã€‚

  ![image-20250120234325232](https://blog-1304565468.cos.ap-shanghai.myqcloud.com/work/image-20250120234325232.png)

æ¥ä¸‹æ¥æˆ‘ä»¬è¦åšä¸€ä¸ªå·¥å…·æ¥å¸®æˆ‘ç›‘æ§æˆ‘çš„å…¬å¸é¡¹ç›®æ˜¯å¦éƒ½æ­£å¸¸è¿è¡Œã€‚å¦‚æœå‡ºé—®é¢˜äº†ï¼Œå°±éœ€è¦èµ¶ç´§é€šçŸ¥æˆ‘å‡ºäº‹äº†ï¼Œèµ¶ç´§çˆ¬èµ·æ¥ä¿® bug ï¼

ç®€å•çš„æ¢³ç†äº†ä¸€ä¸‹éœ€æ±‚ï¼Œæˆ‘ä½¿ç”¨äº†å®ƒçš„ builder èƒ½åŠ›æ¥åˆå§‹åŒ–é¡¹ç›®ï¼Œæé—®ï¼šâ€œæˆ‘è¦åšä¸€ä¸ªå°çš„å·¥å…·æ¥å¸®æˆ‘ä»¬ç›‘æ§æˆ‘çš„å…¬å¸é¡¹ç›®æ˜¯å¦éƒ½æ­£å¸¸è¿è¡Œã€‚å¦‚æœå‡ºé—®é¢˜äº†ï¼Œå°±éœ€è¦èµ¶ç´§é€šçŸ¥æˆ‘å‡ºäº‹äº†ï¼Œèµ¶ç´§ä¿® bug ã€‚é€šçŸ¥æ–¹å¼æ˜¯é‚®ç®±é€šçŸ¥ï¼Œä½¿ç”¨å‰ç«¯æŠ€æœ¯å®ç°ï¼Œæˆ‘å¦‚ä½•å®ç°ï¼Ÿæˆ‘ç›®å‰è°ƒç ”å¯ä»¥ä½¿ç”¨ Playwright æ¥åšå……åˆ†çš„ç½‘ç«™å¯ç”¨æ€§æ£€æµ‹ï¼Œä½¿ç”¨nodemailer æ¥è¿›è¡Œé‚®ç®±é€šçŸ¥ï¼Œç”±äº nodemailer æ˜¯å¿…é¡» node ç¯å¢ƒï¼Œæ‰€ä»¥ä½ éœ€è¦ç»™æˆ‘æ­å»ºä¸€ä¸ª node æœåŠ¡â€ï¼Œè¿™é‡Œæˆ‘æ˜¯é¢„å…ˆå‘Šè¯‰äº†å®ƒå¦‚ä½•å®ç°ï¼Œé˜²æ­¢å®ƒç»™å‡ºä¸åˆç†çš„å®ç°æ–¹å¼ã€‚

ç„¶åå®ƒå¾ˆå¿«ç†è§£äº†æˆ‘ä»¬çš„éœ€æ±‚ï¼Œå¹¶ä¸”æ­å»ºå¥½äº†ä¸€ä¸ªåŸºç¡€æœåŠ¡ï¼š

![image-20250121022615877](https://blog-1304565468.cos.ap-shanghai.myqcloud.com/work/image-20250121022615877.png)

å¯åŠ¨é¡¹ç›®åå‘ç°é‚®ç®±æœåŠ¡æ˜¯æœ‰é—®é¢˜çš„ï¼Œäºæ˜¯æˆ‘æŠŠé”™è¯¯ä¿¡æ¯ç»™å®ƒï¼Œç„¶åé—®å®ƒä¸ºä»€ä¹ˆï¼Ÿå¦‚ä½•ä¿®å¤ï¼Ÿä½†æ˜¯ä¼šå‡ºç°ï¼š

![image-20250121011726558](https://blog-1304565468.cos.ap-shanghai.myqcloud.com/work/image-20250121011726558.png)

äºæ˜¯æˆ‘åªèƒ½åˆ‡æ¢ chat æ¨¡å¼ï¼Œå‘ç°æ˜¯æ­£å¸¸çš„ï¼Œæˆ‘æŠŠé—®é¢˜å’Œç›¸å…³ä»£ç ï¼ˆä½¿ç”¨å¼•ç”¨èƒ½åŠ›ï¼‰ç»™åˆ°å®ƒã€‚å®ƒä¹Ÿå¾ˆå¿«å‘ç°äº†é—®é¢˜ï¼Œç„¶åç»™å‡ºäº†è§£å†³çš„æ–¹æ³•ã€‚

æˆ‘æ¨¡æ‹Ÿäº†ä¸€ä¸ªç½‘ç«™å‡ºç°é—®é¢˜çš„åœºæ™¯ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“æ£€æŸ¥ç½‘ç«™å­˜åœ¨é—®é¢˜çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘å‘é€é‚®ä»¶çš„é€»è¾‘ï¼š

![image-20250121012111907](https://blog-1304565468.cos.ap-shanghai.myqcloud.com/work/image-20250121012111907.png)

åˆ°è¿™é‡ŒåŸºæœ¬çš„æµç¨‹ç®—æ˜¯è·‘é€šäº†ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æé—® AIï¼Œä»£ç å±‚é¢æ˜¯å¦å¯ä»¥ç»§ç»­ä¼˜åŒ–ï¼š

![image-20250121020151382](https://blog-1304565468.cos.ap-shanghai.myqcloud.com/work/image-20250121020151382.png)

å®ƒç»™å‡ºäº†ä¸€äº›æ¯”è¾ƒå¥½çš„å»ºè®®ï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹å‡»â€œå…¨éƒ¨æ¥å—â€ï¼Œç„¶åå…ˆå®‰è£…ä¾èµ–ï¼Œå†æ¬¡å¯åŠ¨æŸ¥çœ‹ä¸€ä¸‹æ•ˆæœï¼š

![image-20250121020340837](https://blog-1304565468.cos.ap-shanghai.myqcloud.com/work/image-20250121020340837.png)

è¿™ä¸€æ¬¡ï¼Œå®ƒç»™å‡ºäº†æ›´åŠ ç»†è‡´çš„æ—¥å¿—ä¿¡æ¯ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°æœ€åä¸€ä¸ª error ä¸å¤ªæ­£å¸¸ï¼Œæˆ‘ä»¬é—®ä¸€ä¸‹ AI è¿™ä¸ªæ˜¯å¦æ˜¯æ­£å¸¸æ—¥å¿—ï¼ŒAI å‘ç°äº†é—®é¢˜ï¼Œå¹¶è¿›è¡Œäº†ä¿®å¤ï¼Œæˆ‘ä»¬é‡å¯éªŒè¯é€»è¾‘æ²¡æœ‰é—®é¢˜

![image-20250121020902787](https://blog-1304565468.cos.ap-shanghai.myqcloud.com/work/image-20250121020902787.png)

é‚®ç®±ä¹Ÿæ”¶åˆ°äº†å‘Šè­¦ä¿¡æ¯ï¼

åˆ°è¿™é‡Œå…¶å®åŸºæœ¬çš„ç‰›é©¬å·²ç»åšå¥½äº†ï¼Œå®ƒèƒ½å¤Ÿå®æ—¶çš„å¸®æˆ‘ç›‘æ§ç½‘ç«™æ˜¯å¦è¿è¡Œè‰¯å¥½ï¼Œä¿è¯æœåŠ¡å¼‚å¸¸åŠæ—¶é€šçŸ¥åˆ°äººã€‚ä½†æ˜¯çœŸæ­£åœºæ™¯ä¸‹ï¼Œéœ€è¦çš„ä¸ä»…ä»…æ˜¯ç½‘ç«™æ­£å¸¸åŠ è½½ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–éœ€è¦ç›‘æ§çš„ä¸œè¥¿ã€‚

ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ AI çš„ä»£ç æ°´å¹³æ€ä¹ˆæ ·å§ï¼

```js
const { chromium } = require("@playwright/test");
const nodemailer = require("nodemailer");
const cron = require("node-cron");
const winston = require("winston"); // æ·»åŠ æ—¥å¿—åº“

// é…ç½®æ—¥å¿—
const logger = winston.createLogger({
  format: winston.format.combine(winston.format.timestamp(), winston.format.json()),
  transports: [
    new winston.transports.File({ filename: "error.log", level: "error" }),
    new winston.transports.File({ filename: "combined.log" }),
    new winston.transports.Console(),
  ],
});

// é‚®ä»¶é…ç½®
const transporter = nodemailer.createTransport({
  host: "smtp.qq.com",
  port: 465, // ä¿®æ”¹ä¸º465ç«¯å£
  secure: true, // è®¾ç½®ä¸ºtrue
  auth: {
    user: "3074994545@qq.com", // è¡¥å……å®Œæ•´çš„QQé‚®ç®±åœ°å€
    pass: "xxxx", // QQé‚®ç®±æˆæƒç 
  },
});

// è¦ç›‘æ§çš„ç½‘ç«™åˆ—è¡¨
const websites = [
  {
    name: "è€é±¼ç®€å†",
    url: "https://laoyujianli.com",
    checkElements: [".laoyu-page-container", ".new-index-page", ".template-item"],
  },
  {
    name: "ç¼–ç¨‹å¯¼èˆª",
    url: "https://codefather.cn",
    checkElements: [".ant-layout", ".user-name"],
  },
  {
    name: "é¢è¯•é¸­",
    url: "https://mianshiya.cn", // ç§»é™¤å¤šä½™çš„ç©ºæ ¼
    checkElements: ["#indexPage", ".ant-list-item", "#ccc"],
    retryCount: 3, // æ·»åŠ é‡è¯•æ¬¡æ•°
    retryDelay: 5000, // é‡è¯•å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  },
];

// æµè§ˆå™¨å®ä¾‹ç®¡ç†
let browserInstance = null;
async function getBrowser() {
  if (!browserInstance) {
    browserInstance = await chromium.launch({
      timeout: 60000,
    });
  }
  return browserInstance;
}

// æ£€æŸ¥ç½‘ç«™å¯ç”¨æ€§
async function checkWebsite(site) {
  const startTime = Date.now();
  const browser = await getBrowser();
  const context = await browser.newContext({
    userAgent:
      "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",
  });

  try {
    const page = await context.newPage();
    logger.info(`æ­£åœ¨æ£€æŸ¥ç½‘ç«™: ${site.name}`);

    let lastError;
    // æ·»åŠ é‡è¯•æœºåˆ¶
    for (let i = 0; i < (site.retryCount || 1); i++) {
      try {
        // è®¾ç½®é¡µé¢åŠ è½½è¶…æ—¶æ—¶é—´
        await page.goto(site.url, {
          timeout: 30000,
          waitUntil: "networkidle", // ç­‰å¾…ç½‘ç»œç©ºé—²
        });

        // æ£€æŸ¥å…³é”®å…ƒç´ æ˜¯å¦å­˜åœ¨
        for (const selector of site.checkElements) {
          try {
            await page.waitForSelector(selector, { timeout: 5000 });
          } catch (elementError) {
            console.log(`å…ƒç´  ${selector} æœªæ‰¾åˆ°ï¼Œç»§ç»­æ£€æŸ¥å…¶ä»–å…ƒç´ `);
          }
        }

        console.log(`${site.name} æ£€æŸ¥é€šè¿‡`);
        return { success: true };
      } catch (error) {
        lastError = error;
        if (i < (site.retryCount || 1) - 1) {
          console.log(`${site.name} æ£€æŸ¥å¤±è´¥ï¼Œç­‰å¾… ${site.retryDelay || 5000}ms åé‡è¯•...`);
          await new Promise((resolve) => setTimeout(resolve, site.retryDelay || 5000));
        }
      }
    }

    console.error(`${site.name} æ£€æŸ¥å¤±è´¥:`, lastError.message);
    return {
      success: false,
      error: lastError.message,
    };
  } finally {
    await context.close(); // åªå…³é—­ contextï¼Œä¸å…³é—­æµè§ˆå™¨
  }
}

// æ·»åŠ è¿›ç¨‹é€€å‡ºæ—¶çš„æ¸…ç†
process.on("SIGTERM", async () => {
  logger.info("æœåŠ¡æ­£åœ¨å…³é—­...");
  if (browserInstance) {
    await browserInstance.close();
    browserInstance = null;
  }
  process.exit(0);
});

process.on("SIGINT", async () => {
  logger.info("æœåŠ¡æ­£åœ¨å…³é—­...");
  if (browserInstance) {
    await browserInstance.close();
    browserInstance = null;
  }
  process.exit(0);
});

// å‘é€å‘Šè­¦é‚®ä»¶
async function sendAlertEmail(site, error) {
  const mailOptions = {
    from: "3074994545@qq.com", // ä½¿ç”¨å®Œæ•´çš„å‘ä»¶äººé‚®ç®±
    to: "3074994545@qq.com", // ä½¿ç”¨å®Œæ•´çš„æ”¶ä»¶äººé‚®ç®±
    subject: `ğŸš¨ ç½‘ç«™å¼‚å¸¸å‘Šè­¦: ${site.name}`,
    html: `
      <h2>ç½‘ç«™ç›‘æ§å‘Šè­¦</h2>
      <p><strong>ç½‘ç«™åç§°:</strong> ${site.name}</p>
      <p><strong>ç½‘ç«™åœ°å€:</strong> ${site.url}</p>
      <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${error}</p>
      <p><strong>å‘ç”Ÿæ—¶é—´:</strong> ${new Date().toLocaleString()}</p>
    `,
  };

  try {
    await transporter.sendMail(mailOptions);
    console.log(`å·²å‘é€å‘Šè­¦é‚®ä»¶ - ${site.name}`);
  } catch (error) {
    console.error("å‘é€é‚®ä»¶å¤±è´¥:", error);
    // å¦‚æœæ˜¯è®¤è¯é”™è¯¯ï¼Œè¾“å‡ºæ›´è¯¦ç»†çš„ä¿¡æ¯
    if (error.code === "EAUTH") {
      console.error("é‚®ç®±è®¤è¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š");
      console.error("1. ç¡®ä¿QQé‚®ç®±å·²å¼€å¯SMTPæœåŠ¡");
      console.error("2. ç¡®ä¿ä½¿ç”¨çš„æ˜¯æ­£ç¡®çš„æˆæƒç è€Œä¸æ˜¯é‚®ç®±å¯†ç ");
      console.error("3. è®¿é—® https://service.mail.qq.com/cgi-bin/help?subtype=1&&id=28&&no=1001256 è·å–å¸®åŠ©");
    }
  }
}

// æ‰§è¡Œç›‘æ§ä»»åŠ¡
async function runMonitoring() {
  // æ·»åŠ å¹¶å‘é™åˆ¶
  const concurrentLimit = 2;
  const chunks = [];
  for (let i = 0; i < websites.length; i += concurrentLimit) {
    chunks.push(websites.slice(i, i + concurrentLimit));
  }

  for (const chunk of chunks) {
    await Promise.all(
      chunk.map(async (site) => {
        try {
          const result = await checkWebsite(site);
          if (!result.success) {
            await sendAlertEmail(site, result.error);
          }
        } catch (error) {
          logger.error(`ç›‘æ§ä»»åŠ¡æ‰§è¡Œå¤±è´¥ (${site.name}):`, {
            error: error.message,
            stack: error.stack,
          });
        }
      })
    );
  }
}

// æ·»åŠ ä¼˜é›…é€€å‡ºå¤„ç†
process.on("SIGTERM", async () => {
  logger.info("æœåŠ¡æ­£åœ¨å…³é—­...");
  if (browserInstance) {
    await browserInstance.close();
  }
  process.exit(0);
});

// è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œæ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ç›‘æ§
cron.schedule("*/5 * * * *", () => {
  console.log("å¼€å§‹æ‰§è¡Œç½‘ç«™ç›‘æ§...");
  runMonitoring();
});

// ç«‹å³æ‰§è¡Œä¸€æ¬¡ç›‘æ§
console.log("å¯åŠ¨ç½‘ç«™ç›‘æ§æœåŠ¡...");
runMonitoring();

```

ä½ è§‰å¾—å†™çš„æ€ä¹ˆæ ·å‘¢ï¼Ÿæˆ‘è§‰å¾—è›®å¥½çš„ï¼š

- ä»£ç é€»è¾‘æ¸…æ™°ï¼Œæ¯ä¸ªå‡½æ•°éƒ½ç¬¦åˆå•ä¸€åŸåˆ™ï¼Œå¼€å‘ä¸­å®ƒä¹Ÿæé†’æˆ‘è¦æŠŠ websites é…ç½®ä¿¡æ¯å•ç‹¬åˆ›å»ºæ–‡ä»¶å­˜å‚¨
- èƒ½å¤ŸåŸºäºä»£ç è¿›è¡Œé‡æ„ä¼˜åŒ–ï¼Œä½¿ç”¨ç¤¾åŒºæµè¡Œçš„ winston æ—¥å¿—åº“æ¥è®°å½•ä¿¡æ¯
- æœ‰é‡è¯•ï¼Œtry catch å…œåº•é€»è¾‘



## æ€»ç»“

1. TRAE çš„ UI å’Œäº¤äº’ä¸è¾“ cursor
2. builder æ¨¡å¼ä¸‹ï¼Œæå‡ºä¸€ä¸ªéœ€æ±‚ï¼Œå®ƒèƒ½å¿«é€Ÿå¸®æˆ‘æ‹†è§£éœ€æ±‚ï¼Œç”Ÿæˆé¡¹ç›®ï¼Œå®‰è£…ä¾èµ–ï¼Œå¯åŠ¨é¡¹ç›®åˆ°æœ€åçš„ web é¢„è§ˆã€‚è¿™å¯¹æ²¡æœ‰æ¥è§¦è¿‡ç¼–ç¨‹çš„äººæ›´åŠ å‹å¥½
3. åœ¨æœ‰äº›æ—¶å€™ï¼Œå®ƒä¹Ÿä¼šä¹±è¯´ï¼Œæ˜æ˜æœ‰é—®é¢˜ï¼Œä½†æ˜¯ç¡¬è¯´å·²ç»è§£å†³äº†ï¼
4. è¿æ¥ä¸ç¨³å®šï¼Œç»å¸¸ç½‘ç»œé”™è¯¯ï¼Œè¿™ä¸ªéå¸¸å½±å“å¼€å‘ä½“éªŒ
5. å…è´¹ä½¿ç”¨ claude 3.5 å’Œ chatGpt å¾ˆé¦™ã€‚
6. ä»£ç å—å³ä¸Šè§’çš„ä¸€äº›èƒ½åŠ›éå¸¸å¥½ç”¨ï¼Œä¾‹å¦‚åº”ç”¨åŠŸèƒ½ï¼Œèƒ½å¤Ÿæ™ºèƒ½çš„æŠŠç›¸å…³çš„å†…å®¹è¿›è¡Œæ›¿æ¢ï¼Œç„¶åé€šè¿‡ diff æ¸…æ™°çš„è®©ä½ çŸ¥é“ä½ ä¿®æ”¹äº†ä»€ä¹ˆ
7. æ„Ÿè§‰æ¨¡å‹æ·±åº¦é“¾æ¥äº†ä»£ç ä¸Šä¸‹æ–‡ï¼Œèƒ½ç»™å‡ºå’Œæˆ‘ç›®å‰é¡¹ç›®ç›¸å…³çš„ä»£ç 
8. æš´è®ºï¼šç”±äºæ¨¡å‹èƒ½åŠ›çš„é™åˆ¶ï¼Œæ— è®ºå¦‚ä½•ä¼˜åŒ–äº¤äº’ï¼Œæµç¨‹ã€‚ç›®å‰æ²¡æœ‰ç¼–ç¨‹åŸºç¡€çš„äººå¾ˆéš¾ä½¿ç”¨ AI ç¼–è¾‘å™¨å¼€å‘å‡ºçœŸæ­£çš„äº§å“


éœ€è¦æ·±åº¦ä½¿ç”¨æ‰èƒ½å‘ç°å®ƒæ›´å¤šä½¿ç”¨åœºæ™¯ï¼

> æºç ï¼šhttps://github.com/chaseFunny/niuma

---
æ­¤æ–‡è‡ªåŠ¨å‘å¸ƒäºï¼š<a href="https://github.com/coderPerseus/blog/issues/44" target="_blank">github issues</a>
